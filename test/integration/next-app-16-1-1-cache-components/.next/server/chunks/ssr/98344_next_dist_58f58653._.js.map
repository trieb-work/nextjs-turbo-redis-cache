{"version":3,"sources":["../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/dynamic-rendering-utils.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/router/utils/parse-path.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/router/utils/path-has-prefix.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/router/utils/remove-path-prefix.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/lib/trace/constants.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/is-thenable.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/lib/trace/tracer.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/lib/detached-promise.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/lib/scheduler.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/stream-utils/encoded-tags.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/stream-utils/uint8array-helpers.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/errors/constants.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/segment-cache/output-export-prefetch-encoding.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/router/utils/cache-busting-search-param.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/stream-utils/node-web-streams-helper.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/client/components/hooks-server-context.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/client/components/static-generation-bailout.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/lib/framework/boundary-constants.tsx","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/lazy-dynamic/bailout-to-csr.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/app-render/dynamic-rendering.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/request-meta.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/i18n/detect-domain-locale.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/router/utils/add-path-prefix.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/router/utils/add-path-suffix.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/router/utils/add-locale.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/router/utils/format-next-pathname-info.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/get-hostname.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/router/utils/get-next-pathname-info.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/web/next-url.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/web/error.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/web/spec-extension/cookies.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/web/spec-extension/request.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/base-http/helpers.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/web/spec-extension/adapters/next-request.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/client-component-renderer-logger.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/pipe-readable.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/promise-with-resolvers.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/server/app-render/staged-rendering.ts","../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/shared/lib/action-revalidation-kind.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","import type { NonStaticRenderStage } from './app-render/staged-rendering'\nimport type { RequestStore } from './app-render/work-unit-async-storage.external'\n\nexport function isHangingPromiseRejectionError(\n  err: unknown\n): err is HangingPromiseRejectionError {\n  if (typeof err !== 'object' || err === null || !('digest' in err)) {\n    return false\n  }\n\n  return err.digest === HANGING_PROMISE_REJECTION\n}\n\nconst HANGING_PROMISE_REJECTION = 'HANGING_PROMISE_REJECTION'\n\nclass HangingPromiseRejectionError extends Error {\n  public readonly digest = HANGING_PROMISE_REJECTION\n\n  constructor(\n    public readonly route: string,\n    public readonly expression: string\n  ) {\n    super(\n      `During prerendering, ${expression} rejects when the prerender is complete. Typically these errors are handled by React but if you move ${expression} to a different context by using \\`setTimeout\\`, \\`after\\`, or similar functions you may observe this error and you should handle it in that context. This occurred at route \"${route}\".`\n    )\n  }\n}\n\ntype AbortListeners = Array<(err: unknown) => void>\nconst abortListenersBySignal = new WeakMap<AbortSignal, AbortListeners>()\n\n/**\n * This function constructs a promise that will never resolve. This is primarily\n * useful for cacheComponents where we use promise resolution timing to determine which\n * parts of a render can be included in a prerender.\n *\n * @internal\n */\nexport function makeHangingPromise<T>(\n  signal: AbortSignal,\n  route: string,\n  expression: string\n): Promise<T> {\n  if (signal.aborted) {\n    return Promise.reject(new HangingPromiseRejectionError(route, expression))\n  } else {\n    const hangingPromise = new Promise<T>((_, reject) => {\n      const boundRejection = reject.bind(\n        null,\n        new HangingPromiseRejectionError(route, expression)\n      )\n      let currentListeners = abortListenersBySignal.get(signal)\n      if (currentListeners) {\n        currentListeners.push(boundRejection)\n      } else {\n        const listeners = [boundRejection]\n        abortListenersBySignal.set(signal, listeners)\n        signal.addEventListener(\n          'abort',\n          () => {\n            for (let i = 0; i < listeners.length; i++) {\n              listeners[i]()\n            }\n          },\n          { once: true }\n        )\n      }\n    })\n    // We are fine if no one actually awaits this promise. We shouldn't consider this an unhandled rejection so\n    // we attach a noop catch handler here to suppress this warning. If you actually await somewhere or construct\n    // your own promise out of it you'll need to ensure you handle the error when it rejects.\n    hangingPromise.catch(ignoreReject)\n    return hangingPromise\n  }\n}\n\nfunction ignoreReject() {}\n\nexport function makeDevtoolsIOAwarePromise<T>(\n  underlying: T,\n  requestStore: RequestStore,\n  stage: NonStaticRenderStage\n): Promise<T> {\n  if (requestStore.stagedRendering) {\n    // We resolve each stage in a timeout, so React DevTools will pick this up as IO.\n    return requestStore.stagedRendering.delayUntilStage(\n      stage,\n      undefined,\n      underlying\n    )\n  }\n  // in React DevTools if we resolve in a setTimeout we will observe\n  // the promise resolution as something that can suspend a boundary or root.\n  return new Promise<T>((resolve) => {\n    // Must use setTimeout to be considered IO React DevTools. setImmediate will not work.\n    setTimeout(() => {\n      resolve(underlying)\n    }, 0)\n  })\n}\n","/**\n * Given a path this function will find the pathname, query and hash and return\n * them. This is useful to parse full paths on the client side.\n * @param path A path to parse e.g. /foo/bar?id=1#hash\n */\nexport function parsePath(path: string) {\n  const hashIndex = path.indexOf('#')\n  const queryIndex = path.indexOf('?')\n  const hasQuery = queryIndex > -1 && (hashIndex < 0 || queryIndex < hashIndex)\n\n  if (hasQuery || hashIndex > -1) {\n    return {\n      pathname: path.substring(0, hasQuery ? queryIndex : hashIndex),\n      query: hasQuery\n        ? path.substring(queryIndex, hashIndex > -1 ? hashIndex : undefined)\n        : '',\n      hash: hashIndex > -1 ? path.slice(hashIndex) : '',\n    }\n  }\n\n  return { pathname: path, query: '', hash: '' }\n}\n","import { parsePath } from './parse-path'\n\n/**\n * Checks if a given path starts with a given prefix. It ensures it matches\n * exactly without containing extra chars. e.g. prefix /docs should replace\n * for /docs, /docs/, /docs/a but not /docsss\n * @param path The path to check.\n * @param prefix The prefix to check against.\n */\nexport function pathHasPrefix(path: string, prefix: string) {\n  if (typeof path !== 'string') {\n    return false\n  }\n\n  const { pathname } = parsePath(path)\n  return pathname === prefix || pathname.startsWith(prefix + '/')\n}\n","import { pathHasPrefix } from './path-has-prefix'\n\n/**\n * Given a path and a prefix it will remove the prefix when it exists in the\n * given path. It ensures it matches exactly without containing extra chars\n * and if the prefix is not there it will be noop.\n *\n * @param path The path to remove the prefix from.\n * @param prefix The prefix to be removed.\n */\nexport function removePathPrefix(path: string, prefix: string): string {\n  // If the path doesn't start with the prefix we can return it as is. This\n  // protects us from situations where the prefix is a substring of the path\n  // prefix such as:\n  //\n  // For prefix: /blog\n  //\n  //   /blog -> true\n  //   /blog/ -> true\n  //   /blog/1 -> true\n  //   /blogging -> false\n  //   /blogging/ -> false\n  //   /blogging/1 -> false\n  if (!pathHasPrefix(path, prefix)) {\n    return path\n  }\n\n  // Remove the prefix from the path via slicing.\n  const withoutPrefix = path.slice(prefix.length)\n\n  // If the path without the prefix starts with a `/` we can return it as is.\n  if (withoutPrefix.startsWith('/')) {\n    return withoutPrefix\n  }\n\n  // If the path without the prefix doesn't start with a `/` we need to add it\n  // back to the path to make sure it's a valid path.\n  return `/${withoutPrefix}`\n}\n","/**\n * Contains predefined constants for the trace span name in next/server.\n *\n * Currently, next/server/tracer is internal implementation only for tracking\n * next.js's implementation only with known span names defined here.\n **/\n\n// eslint typescript has a bug with TS enums\n\nenum BaseServerSpan {\n  handleRequest = 'BaseServer.handleRequest',\n  run = 'BaseServer.run',\n  pipe = 'BaseServer.pipe',\n  getStaticHTML = 'BaseServer.getStaticHTML',\n  render = 'BaseServer.render',\n  renderToResponseWithComponents = 'BaseServer.renderToResponseWithComponents',\n  renderToResponse = 'BaseServer.renderToResponse',\n  renderToHTML = 'BaseServer.renderToHTML',\n  renderError = 'BaseServer.renderError',\n  renderErrorToResponse = 'BaseServer.renderErrorToResponse',\n  renderErrorToHTML = 'BaseServer.renderErrorToHTML',\n  render404 = 'BaseServer.render404',\n}\n\nenum LoadComponentsSpan {\n  loadDefaultErrorComponents = 'LoadComponents.loadDefaultErrorComponents',\n  loadComponents = 'LoadComponents.loadComponents',\n}\n\nenum NextServerSpan {\n  getRequestHandler = 'NextServer.getRequestHandler',\n  getRequestHandlerWithMetadata = 'NextServer.getRequestHandlerWithMetadata',\n  getServer = 'NextServer.getServer',\n  getServerRequestHandler = 'NextServer.getServerRequestHandler',\n  createServer = 'createServer.createServer',\n}\n\nenum NextNodeServerSpan {\n  compression = 'NextNodeServer.compression',\n  getBuildId = 'NextNodeServer.getBuildId',\n  createComponentTree = 'NextNodeServer.createComponentTree',\n  clientComponentLoading = 'NextNodeServer.clientComponentLoading',\n  getLayoutOrPageModule = 'NextNodeServer.getLayoutOrPageModule',\n  generateStaticRoutes = 'NextNodeServer.generateStaticRoutes',\n  generateFsStaticRoutes = 'NextNodeServer.generateFsStaticRoutes',\n  generatePublicRoutes = 'NextNodeServer.generatePublicRoutes',\n  generateImageRoutes = 'NextNodeServer.generateImageRoutes.route',\n  sendRenderResult = 'NextNodeServer.sendRenderResult',\n  proxyRequest = 'NextNodeServer.proxyRequest',\n  runApi = 'NextNodeServer.runApi',\n  render = 'NextNodeServer.render',\n  renderHTML = 'NextNodeServer.renderHTML',\n  imageOptimizer = 'NextNodeServer.imageOptimizer',\n  getPagePath = 'NextNodeServer.getPagePath',\n  getRoutesManifest = 'NextNodeServer.getRoutesManifest',\n  findPageComponents = 'NextNodeServer.findPageComponents',\n  getFontManifest = 'NextNodeServer.getFontManifest',\n  getServerComponentManifest = 'NextNodeServer.getServerComponentManifest',\n  getRequestHandler = 'NextNodeServer.getRequestHandler',\n  renderToHTML = 'NextNodeServer.renderToHTML',\n  renderError = 'NextNodeServer.renderError',\n  renderErrorToHTML = 'NextNodeServer.renderErrorToHTML',\n  render404 = 'NextNodeServer.render404',\n  startResponse = 'NextNodeServer.startResponse',\n\n  // nested inner span, does not require parent scope name\n  route = 'route',\n  onProxyReq = 'onProxyReq',\n  apiResolver = 'apiResolver',\n  internalFetch = 'internalFetch',\n}\n\nenum StartServerSpan {\n  startServer = 'startServer.startServer',\n}\n\nenum RenderSpan {\n  getServerSideProps = 'Render.getServerSideProps',\n  getStaticProps = 'Render.getStaticProps',\n  renderToString = 'Render.renderToString',\n  renderDocument = 'Render.renderDocument',\n  createBodyResult = 'Render.createBodyResult',\n}\n\nenum AppRenderSpan {\n  renderToString = 'AppRender.renderToString',\n  renderToReadableStream = 'AppRender.renderToReadableStream',\n  getBodyResult = 'AppRender.getBodyResult',\n  fetch = 'AppRender.fetch',\n}\n\nenum RouterSpan {\n  executeRoute = 'Router.executeRoute',\n}\n\nenum NodeSpan {\n  runHandler = 'Node.runHandler',\n}\n\nenum AppRouteRouteHandlersSpan {\n  runHandler = 'AppRouteRouteHandlers.runHandler',\n}\n\nenum ResolveMetadataSpan {\n  generateMetadata = 'ResolveMetadata.generateMetadata',\n  generateViewport = 'ResolveMetadata.generateViewport',\n}\n\nenum MiddlewareSpan {\n  execute = 'Middleware.execute',\n}\n\ntype SpanTypes =\n  | `${BaseServerSpan}`\n  | `${LoadComponentsSpan}`\n  | `${NextServerSpan}`\n  | `${StartServerSpan}`\n  | `${NextNodeServerSpan}`\n  | `${RenderSpan}`\n  | `${RouterSpan}`\n  | `${AppRenderSpan}`\n  | `${NodeSpan}`\n  | `${AppRouteRouteHandlersSpan}`\n  | `${ResolveMetadataSpan}`\n  | `${MiddlewareSpan}`\n\n// This list is used to filter out spans that are not relevant to the user\nexport const NextVanillaSpanAllowlist = new Set([\n  MiddlewareSpan.execute,\n  BaseServerSpan.handleRequest,\n  RenderSpan.getServerSideProps,\n  RenderSpan.getStaticProps,\n  AppRenderSpan.fetch,\n  AppRenderSpan.getBodyResult,\n  RenderSpan.renderDocument,\n  NodeSpan.runHandler,\n  AppRouteRouteHandlersSpan.runHandler,\n  ResolveMetadataSpan.generateMetadata,\n  ResolveMetadataSpan.generateViewport,\n  NextNodeServerSpan.createComponentTree,\n  NextNodeServerSpan.findPageComponents,\n  NextNodeServerSpan.getLayoutOrPageModule,\n  NextNodeServerSpan.startResponse,\n  NextNodeServerSpan.clientComponentLoading,\n])\n\n// These Spans are allowed to be always logged\n// when the otel log prefix env is set\nexport const LogSpanAllowList = new Set([\n  NextNodeServerSpan.findPageComponents,\n  NextNodeServerSpan.createComponentTree,\n  NextNodeServerSpan.clientComponentLoading,\n])\n\nexport {\n  BaseServerSpan,\n  LoadComponentsSpan,\n  NextServerSpan,\n  NextNodeServerSpan,\n  StartServerSpan,\n  RenderSpan,\n  RouterSpan,\n  AppRenderSpan,\n  NodeSpan,\n  AppRouteRouteHandlersSpan,\n  ResolveMetadataSpan,\n  MiddlewareSpan,\n}\n\nexport type { SpanTypes }\n","/**\n * Check to see if a value is Thenable.\n *\n * @param promise the maybe-thenable value\n * @returns true if the value is thenable\n */\nexport function isThenable<T = unknown>(\n  promise: Promise<T> | T\n): promise is Promise<T> {\n  return (\n    promise !== null &&\n    typeof promise === 'object' &&\n    'then' in promise &&\n    typeof promise.then === 'function'\n  )\n}\n","import type { FetchEventResult } from '../../web/types'\nimport type { TextMapSetter } from '@opentelemetry/api'\nimport type { SpanTypes } from './constants'\nimport { LogSpanAllowList, NextVanillaSpanAllowlist } from './constants'\n\nimport type {\n  ContextAPI,\n  Span,\n  SpanOptions,\n  Tracer,\n  AttributeValue,\n  TextMapGetter,\n} from 'next/dist/compiled/@opentelemetry/api'\nimport { isThenable } from '../../../shared/lib/is-thenable'\n\nconst NEXT_OTEL_PERFORMANCE_PREFIX = process.env.NEXT_OTEL_PERFORMANCE_PREFIX\n\nlet api: typeof import('next/dist/compiled/@opentelemetry/api')\n\n// we want to allow users to use their own version of @opentelemetry/api if they\n// want to, so we try to require it first, and if it fails we fall back to the\n// version that is bundled with Next.js\n// this is because @opentelemetry/api has to be synced with the version of\n// @opentelemetry/tracing that is used, and we don't want to force users to use\n// the version that is bundled with Next.js.\n// the API is ~stable, so this should be fine\nif (process.env.NEXT_RUNTIME === 'edge') {\n  api = require('@opentelemetry/api') as typeof import('@opentelemetry/api')\n} else {\n  try {\n    api = require('@opentelemetry/api') as typeof import('@opentelemetry/api')\n  } catch (err) {\n    api =\n      require('next/dist/compiled/@opentelemetry/api') as typeof import('next/dist/compiled/@opentelemetry/api')\n  }\n}\n\nconst { context, propagation, trace, SpanStatusCode, SpanKind, ROOT_CONTEXT } =\n  api\n\nexport class BubbledError extends Error {\n  constructor(\n    public readonly bubble?: boolean,\n    public readonly result?: FetchEventResult\n  ) {\n    super()\n  }\n}\n\nexport function isBubbledError(error: unknown): error is BubbledError {\n  if (typeof error !== 'object' || error === null) return false\n  return error instanceof BubbledError\n}\n\nconst closeSpanWithError = (span: Span, error?: Error) => {\n  if (isBubbledError(error) && error.bubble) {\n    span.setAttribute('next.bubble', true)\n  } else {\n    if (error) {\n      span.recordException(error)\n      span.setAttribute('error.type', error.name)\n    }\n    span.setStatus({ code: SpanStatusCode.ERROR, message: error?.message })\n  }\n  span.end()\n}\n\ntype TracerSpanOptions = Omit<SpanOptions, 'attributes'> & {\n  parentSpan?: Span\n  spanName?: string\n  attributes?: Partial<Record<AttributeNames, AttributeValue | undefined>>\n  hideSpan?: boolean\n}\n\ninterface NextTracer {\n  getContext(): ContextAPI\n\n  /**\n   * Instruments a function by automatically creating a span activated on its\n   * scope.\n   *\n   * The span will automatically be finished when one of these conditions is\n   * met:\n   *\n   * * The function returns a promise, in which case the span will finish when\n   * the promise is resolved or rejected.\n   * * The function takes a callback as its second parameter, in which case the\n   * span will finish when that callback is called.\n   * * The function doesn't accept a callback and doesn't return a promise, in\n   * which case the span will finish at the end of the function execution.\n   *\n   */\n  trace<T>(\n    type: SpanTypes,\n    fn: (span?: Span, done?: (error?: Error) => any) => Promise<T>\n  ): Promise<T>\n  trace<T>(\n    type: SpanTypes,\n    fn: (span?: Span, done?: (error?: Error) => any) => T\n  ): T\n  trace<T>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: (span?: Span, done?: (error?: Error) => any) => Promise<T>\n  ): Promise<T>\n  trace<T>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: (span?: Span, done?: (error?: Error) => any) => T\n  ): T\n\n  /**\n   * Wrap a function to automatically create a span activated on its\n   * scope when it's called.\n   *\n   * The span will automatically be finished when one of these conditions is\n   * met:\n   *\n   * * The function returns a promise, in which case the span will finish when\n   * the promise is resolved or rejected.\n   * * The function takes a callback as its last parameter, in which case the\n   * span will finish when that callback is called.\n   * * The function doesn't accept a callback and doesn't return a promise, in\n   * which case the span will finish at the end of the function execution.\n   */\n  wrap<T = (...args: Array<any>) => any>(type: SpanTypes, fn: T): T\n  wrap<T = (...args: Array<any>) => any>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: T\n  ): T\n  wrap<T = (...args: Array<any>) => any>(\n    type: SpanTypes,\n    options: (...args: any[]) => TracerSpanOptions,\n    fn: T\n  ): T\n\n  /**\n   * Starts and returns a new Span representing a logical unit of work.\n   *\n   * This method do NOT modify the current Context by default. In result, any inner span will not\n   * automatically set its parent context to the span created by this method unless manually activate\n   * context via `tracer.getContext().with`. `trace`, or `wrap` is generally recommended as it gracefully\n   * handles context activation. (ref: https://github.com/open-telemetry/opentelemetry-js/issues/1923)\n   */\n  startSpan(type: SpanTypes): Span\n  startSpan(type: SpanTypes, options: TracerSpanOptions): Span\n\n  /**\n   * Returns currently activated span if current context is in the scope of the span.\n   * Returns undefined otherwise.\n   */\n  getActiveScopeSpan(): Span | undefined\n\n  /**\n   * Returns trace propagation data for the currently active context. The format is equal to data provided\n   * through the OpenTelemetry propagator API.\n   */\n  getTracePropagationData(): ClientTraceDataEntry[]\n\n  /**\n   * Executes a function with the given span set as the active span in the context.\n   * This allows child spans created within the function to automatically parent to this span.\n   */\n  withSpan<T>(span: Span, fn: () => T): T\n}\n\ntype NextAttributeNames =\n  | 'next.route'\n  | 'next.page'\n  | 'next.rsc'\n  | 'next.segment'\n  | 'next.span_name'\n  | 'next.span_type'\n  | 'next.clientComponentLoadCount'\ntype OTELAttributeNames = `http.${string}` | `net.${string}`\ntype AttributeNames = NextAttributeNames | OTELAttributeNames\n\n/** we use this map to propagate attributes from nested spans to the top span */\nconst rootSpanAttributesStore = new Map<\n  number,\n  Map<AttributeNames, AttributeValue | undefined>\n>()\nconst rootSpanIdKey = api.createContextKey('next.rootSpanId')\nlet lastSpanId = 0\nconst getSpanId = () => lastSpanId++\n\nexport interface ClientTraceDataEntry {\n  key: string\n  value: string\n}\n\nconst clientTraceDataSetter: TextMapSetter<ClientTraceDataEntry[]> = {\n  set(carrier, key, value) {\n    carrier.push({\n      key,\n      value,\n    })\n  },\n}\n\nclass NextTracerImpl implements NextTracer {\n  /**\n   * Returns an instance to the trace with configured name.\n   * Since wrap / trace can be defined in any place prior to actual trace subscriber initialization,\n   * This should be lazily evaluated.\n   */\n  private getTracerInstance(): Tracer {\n    return trace.getTracer('next.js', '0.0.1')\n  }\n\n  public getContext(): ContextAPI {\n    return context\n  }\n\n  public getTracePropagationData(): ClientTraceDataEntry[] {\n    const activeContext = context.active()\n    const entries: ClientTraceDataEntry[] = []\n    propagation.inject(activeContext, entries, clientTraceDataSetter)\n    return entries\n  }\n\n  public getActiveScopeSpan(): Span | undefined {\n    return trace.getSpan(context?.active())\n  }\n\n  public withPropagatedContext<T, C>(\n    carrier: C,\n    fn: () => T,\n    getter?: TextMapGetter<C>\n  ): T {\n    const activeContext = context.active()\n    if (trace.getSpanContext(activeContext)) {\n      // Active span is already set, too late to propagate.\n      return fn()\n    }\n    const remoteContext = propagation.extract(activeContext, carrier, getter)\n    return context.with(remoteContext, fn)\n  }\n\n  // Trace, wrap implementation is inspired by datadog trace implementation\n  // (https://datadoghq.dev/dd-trace-js/interfaces/tracer.html#trace).\n  public trace<T>(\n    type: SpanTypes,\n    fn: (span?: Span, done?: (error?: Error) => any) => Promise<T>\n  ): Promise<T>\n  public trace<T>(\n    type: SpanTypes,\n    fn: (span?: Span, done?: (error?: Error) => any) => T\n  ): T\n  public trace<T>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: (span?: Span, done?: (error?: Error) => any) => Promise<T>\n  ): Promise<T>\n  public trace<T>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: (span?: Span, done?: (error?: Error) => any) => T\n  ): T\n  public trace<T>(...args: Array<any>) {\n    const [type, fnOrOptions, fnOrEmpty] = args\n\n    // coerce options form overload\n    const {\n      fn,\n      options,\n    }: {\n      fn: (span?: Span, done?: (error?: Error) => any) => T | Promise<T>\n      options: TracerSpanOptions\n    } =\n      typeof fnOrOptions === 'function'\n        ? {\n            fn: fnOrOptions,\n            options: {},\n          }\n        : {\n            fn: fnOrEmpty,\n            options: { ...fnOrOptions },\n          }\n\n    const spanName = options.spanName ?? type\n\n    if (\n      (!NextVanillaSpanAllowlist.has(type) &&\n        process.env.NEXT_OTEL_VERBOSE !== '1') ||\n      options.hideSpan\n    ) {\n      return fn()\n    }\n\n    // Trying to get active scoped span to assign parent. If option specifies parent span manually, will try to use it.\n    let spanContext = this.getSpanContext(\n      options?.parentSpan ?? this.getActiveScopeSpan()\n    )\n\n    if (!spanContext) {\n      spanContext = context?.active() ?? ROOT_CONTEXT\n    }\n    // Check if there's already a root span in the store for this trace\n    // We are intentionally not checking whether there is an active context\n    // from outside of nextjs to ensure that we can provide the same level\n    // of telemetry when using a custom server\n    const existingRootSpanId = spanContext.getValue(rootSpanIdKey)\n    const isRootSpan =\n      typeof existingRootSpanId !== 'number' ||\n      !rootSpanAttributesStore.has(existingRootSpanId)\n\n    const spanId = getSpanId()\n\n    options.attributes = {\n      'next.span_name': spanName,\n      'next.span_type': type,\n      ...options.attributes,\n    }\n\n    return context.with(spanContext.setValue(rootSpanIdKey, spanId), () =>\n      this.getTracerInstance().startActiveSpan(\n        spanName,\n        options,\n        (span: Span) => {\n          let startTime: number | undefined\n          if (\n            NEXT_OTEL_PERFORMANCE_PREFIX &&\n            type &&\n            LogSpanAllowList.has(type)\n          ) {\n            startTime =\n              'performance' in globalThis && 'measure' in performance\n                ? globalThis.performance.now()\n                : undefined\n          }\n\n          let cleanedUp = false\n          const onCleanup = () => {\n            if (cleanedUp) return\n            cleanedUp = true\n            rootSpanAttributesStore.delete(spanId)\n            if (startTime) {\n              performance.measure(\n                `${NEXT_OTEL_PERFORMANCE_PREFIX}:next-${(\n                  type.split('.').pop() || ''\n                ).replace(\n                  /[A-Z]/g,\n                  (match: string) => '-' + match.toLowerCase()\n                )}`,\n                {\n                  start: startTime,\n                  end: performance.now(),\n                }\n              )\n            }\n          }\n\n          if (isRootSpan) {\n            rootSpanAttributesStore.set(\n              spanId,\n              new Map(\n                Object.entries(options.attributes ?? {}) as [\n                  AttributeNames,\n                  AttributeValue | undefined,\n                ][]\n              )\n            )\n          }\n          if (fn.length > 1) {\n            try {\n              return fn(span, (err) => closeSpanWithError(span, err))\n            } catch (err: any) {\n              closeSpanWithError(span, err)\n              throw err\n            } finally {\n              onCleanup()\n            }\n          }\n\n          try {\n            const result = fn(span)\n            if (isThenable(result)) {\n              // If there's error make sure it throws\n              return result\n                .then((res) => {\n                  span.end()\n                  // Need to pass down the promise result,\n                  // it could be react stream response with error { error, stream }\n                  return res\n                })\n                .catch((err) => {\n                  closeSpanWithError(span, err)\n                  throw err\n                })\n                .finally(onCleanup)\n            } else {\n              span.end()\n              onCleanup()\n            }\n\n            return result\n          } catch (err: any) {\n            closeSpanWithError(span, err)\n            onCleanup()\n            throw err\n          }\n        }\n      )\n    )\n  }\n\n  public wrap<T = (...args: Array<any>) => any>(type: SpanTypes, fn: T): T\n  public wrap<T = (...args: Array<any>) => any>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: T\n  ): T\n  public wrap<T = (...args: Array<any>) => any>(\n    type: SpanTypes,\n    options: (...args: any[]) => TracerSpanOptions,\n    fn: T\n  ): T\n  public wrap(...args: Array<any>) {\n    const tracer = this\n    const [name, options, fn] =\n      args.length === 3 ? args : [args[0], {}, args[1]]\n\n    if (\n      !NextVanillaSpanAllowlist.has(name) &&\n      process.env.NEXT_OTEL_VERBOSE !== '1'\n    ) {\n      return fn\n    }\n\n    return function (this: any) {\n      let optionsObj = options\n      if (typeof optionsObj === 'function' && typeof fn === 'function') {\n        optionsObj = optionsObj.apply(this, arguments)\n      }\n\n      const lastArgId = arguments.length - 1\n      const cb = arguments[lastArgId]\n\n      if (typeof cb === 'function') {\n        const scopeBoundCb = tracer.getContext().bind(context.active(), cb)\n        return tracer.trace(name, optionsObj, (_span, done) => {\n          arguments[lastArgId] = function (err: any) {\n            done?.(err)\n            return scopeBoundCb.apply(this, arguments)\n          }\n\n          return fn.apply(this, arguments)\n        })\n      } else {\n        return tracer.trace(name, optionsObj, () => fn.apply(this, arguments))\n      }\n    }\n  }\n\n  public startSpan(type: SpanTypes): Span\n  public startSpan(type: SpanTypes, options: TracerSpanOptions): Span\n  public startSpan(...args: Array<any>): Span {\n    const [type, options]: [string, TracerSpanOptions | undefined] = args as any\n\n    const spanContext = this.getSpanContext(\n      options?.parentSpan ?? this.getActiveScopeSpan()\n    )\n    return this.getTracerInstance().startSpan(type, options, spanContext)\n  }\n\n  private getSpanContext(parentSpan?: Span) {\n    const spanContext = parentSpan\n      ? trace.setSpan(context.active(), parentSpan)\n      : undefined\n\n    return spanContext\n  }\n\n  public getRootSpanAttributes() {\n    const spanId = context.active().getValue(rootSpanIdKey) as number\n    return rootSpanAttributesStore.get(spanId)\n  }\n\n  public setRootSpanAttribute(key: AttributeNames, value: AttributeValue) {\n    const spanId = context.active().getValue(rootSpanIdKey) as number\n    const attributes = rootSpanAttributesStore.get(spanId)\n    if (attributes && !attributes.has(key)) {\n      attributes.set(key, value)\n    }\n  }\n\n  public withSpan<T>(span: Span, fn: () => T): T {\n    const spanContext = trace.setSpan(context.active(), span)\n    return context.with(spanContext, fn)\n  }\n}\n\nconst getTracer = (() => {\n  const tracer = new NextTracerImpl()\n\n  return () => tracer\n})()\n\nexport { getTracer, SpanStatusCode, SpanKind }\nexport type { NextTracer, Span, SpanOptions, ContextAPI, TracerSpanOptions }\n","/**\n * A `Promise.withResolvers` implementation that exposes the `resolve` and\n * `reject` functions on a `Promise`.\n *\n * @see https://tc39.es/proposal-promise-with-resolvers/\n */\nexport class DetachedPromise<T = any> {\n  public readonly resolve: (value: T | PromiseLike<T>) => void\n  public readonly reject: (reason: any) => void\n  public readonly promise: Promise<T>\n\n  constructor() {\n    let resolve: (value: T | PromiseLike<T>) => void\n    let reject: (reason: any) => void\n\n    // Create the promise and assign the resolvers to the object.\n    this.promise = new Promise<T>((res, rej) => {\n      resolve = res\n      reject = rej\n    })\n\n    // We know that resolvers is defined because the Promise constructor runs\n    // synchronously.\n    this.resolve = resolve!\n    this.reject = reject!\n  }\n}\n","export type ScheduledFn<T = void> = () => T | PromiseLike<T>\nexport type SchedulerFn<T = void> = (cb: ScheduledFn<T>) => void\n\n/**\n * Schedules a function to be called on the next tick after the other promises\n * have been resolved.\n *\n * @param cb the function to schedule\n */\nexport const scheduleOnNextTick = (cb: ScheduledFn<void>) => {\n  // We use Promise.resolve().then() here so that the operation is scheduled at\n  // the end of the promise job queue, we then add it to the next process tick\n  // to ensure it's evaluated afterwards.\n  //\n  // This was inspired by the implementation of the DataLoader interface: https://github.com/graphql/dataloader/blob/d336bd15282664e0be4b4a657cb796f09bafbc6b/src/index.js#L213-L255\n  //\n  Promise.resolve().then(() => {\n    if (process.env.NEXT_RUNTIME === 'edge') {\n      setTimeout(cb, 0)\n    } else {\n      process.nextTick(cb)\n    }\n  })\n}\n\n/**\n * Schedules a function to be called using `setImmediate` or `setTimeout` if\n * `setImmediate` is not available (like in the Edge runtime).\n *\n * @param cb the function to schedule\n */\nexport const scheduleImmediate = (cb: ScheduledFn<void>): void => {\n  if (process.env.NEXT_RUNTIME === 'edge') {\n    setTimeout(cb, 0)\n  } else {\n    setImmediate(cb)\n  }\n}\n\n/**\n * returns a promise than resolves in a future task. There is no guarantee that the task it resolves in\n * will be the next task but if you await it you can at least be sure that the current task is over and\n * most usefully that the entire microtask queue of the current task has been emptied.\n */\nexport function atLeastOneTask() {\n  return new Promise<void>((resolve) => scheduleImmediate(resolve))\n}\n\n/**\n * This utility function is extracted to make it easier to find places where we are doing\n * specific timing tricks to try to schedule work after React has rendered. This is especially\n * important at the moment because Next.js uses the edge builds of React which use setTimeout to\n * schedule work when you might expect that something like setImmediate would do the trick.\n *\n * Long term we should switch to the node versions of React rendering when possible and then\n * update this to use setImmediate rather than setTimeout\n */\nexport function waitAtLeastOneReactRenderTask(): Promise<void> {\n  if (process.env.NEXT_RUNTIME === 'edge') {\n    return new Promise((r) => setTimeout(r, 0))\n  } else {\n    return new Promise((r) => setImmediate(r))\n  }\n}\n","export const ENCODED_TAGS = {\n  // opening tags do not have the closing `>` since they can contain other attributes such as `<body className=''>`\n  OPENING: {\n    // <html\n    HTML: new Uint8Array([60, 104, 116, 109, 108]),\n    // <body\n    BODY: new Uint8Array([60, 98, 111, 100, 121]),\n  },\n  CLOSED: {\n    // </head>\n    HEAD: new Uint8Array([60, 47, 104, 101, 97, 100, 62]),\n    // </body>\n    BODY: new Uint8Array([60, 47, 98, 111, 100, 121, 62]),\n    // </html>\n    HTML: new Uint8Array([60, 47, 104, 116, 109, 108, 62]),\n    // </body></html>\n    BODY_AND_HTML: new Uint8Array([\n      60, 47, 98, 111, 100, 121, 62, 60, 47, 104, 116, 109, 108, 62,\n    ]),\n  },\n  META: {\n    // Only the match the prefix cause the suffix can be different wether it's xml compatible or not \">\" or \"/>\"\n    // <meta name=\"«nxt-icon»\"\n    // This is a special mark that will be replaced by the icon insertion script tag.\n    ICON_MARK: new Uint8Array([\n      60, 109, 101, 116, 97, 32, 110, 97, 109, 101, 61, 34, 194, 171, 110, 120,\n      116, 45, 105, 99, 111, 110, 194, 187, 34,\n    ]),\n  },\n} as const\n","/**\n * Find the starting index of Uint8Array `b` within Uint8Array `a`.\n */\nexport function indexOfUint8Array(a: Uint8Array, b: Uint8Array) {\n  if (b.length === 0) return 0\n  if (a.length === 0 || b.length > a.length) return -1\n\n  // start iterating through `a`\n  for (let i = 0; i <= a.length - b.length; i++) {\n    let completeMatch = true\n    // from index `i`, iterate through `b` and check for mismatch\n    for (let j = 0; j < b.length; j++) {\n      // if the values do not match, then this isn't a complete match, exit `b` iteration early and iterate to next index of `a`.\n      if (a[i + j] !== b[j]) {\n        completeMatch = false\n        break\n      }\n    }\n\n    if (completeMatch) {\n      return i\n    }\n  }\n\n  return -1\n}\n\n/**\n * Check if two Uint8Arrays are strictly equivalent.\n */\nexport function isEquivalentUint8Arrays(a: Uint8Array, b: Uint8Array) {\n  if (a.length !== b.length) return false\n\n  for (let i = 0; i < a.length; i++) {\n    if (a[i] !== b[i]) return false\n  }\n\n  return true\n}\n\n/**\n * Remove Uint8Array `b` from Uint8Array `a`.\n *\n * If `b` is not in `a`, `a` is returned unchanged.\n *\n * Otherwise, the function returns a new Uint8Array instance with size `a.length - b.length`\n */\nexport function removeFromUint8Array(a: Uint8Array, b: Uint8Array) {\n  const tagIndex = indexOfUint8Array(a, b)\n  if (tagIndex === 0) return a.subarray(b.length)\n  if (tagIndex > -1) {\n    const removed = new Uint8Array(a.length - b.length)\n    removed.set(a.slice(0, tagIndex))\n    removed.set(a.slice(tagIndex + b.length), tagIndex)\n    return removed\n  } else {\n    return a\n  }\n}\n","export const MISSING_ROOT_TAGS_ERROR = 'NEXT_MISSING_ROOT_TAGS'\n","// In output: export mode, the build id is added to the start of the HTML\n// document, directly after the doctype declaration. During a prefetch, the\n// client performs a range request to get the build id, so it can check whether\n// the target page belongs to the same build.\n//\n// The first 64 bytes of the document are requested. The exact number isn't\n// too important; it must be larger than the build id + doctype + closing and\n// ending comment markers, but it doesn't need to match the end of the\n// comment exactly.\n//\n// Build ids are 21 bytes long in the default implementation, though this\n// can be overridden in the Next.js config. For the purposes of this check,\n// it's OK to only match the start of the id, so we'll truncate it if exceeds\n// a certain length.\n\nconst DOCTYPE_PREFIX = '<!DOCTYPE html>' // 15 bytes\nconst MAX_BUILD_ID_LENGTH = 24\n\nfunction escapeBuildId(buildId: string) {\n  // If the build id is longer than the given limit, it's OK for our purposes\n  // to only match the beginning.\n  const truncated = buildId.slice(0, MAX_BUILD_ID_LENGTH)\n  // Replace hyphens with underscores so it doesn't break the HTML comment.\n  // (Unlikely, but if this did happen it would break the whole document.)\n  return truncated.replace(/-/g, '_')\n}\n\nexport function insertBuildIdComment(originalHtml: string, buildId: string) {\n  if (\n    // Skip if the build id contains a closing comment marker.\n    buildId.includes('-->') ||\n    // React always inserts a doctype at the start of the document. Skip if it\n    // isn't present. Shouldn't happen; suggests an issue elsewhere.\n    !originalHtml.startsWith(DOCTYPE_PREFIX)\n  ) {\n    // Return the original HTML unchanged. This means the document will not\n    // be prefetched.\n    // TODO: The build id comment is currently only used during prefetches, but\n    // if we eventually use this mechanism for regular navigations, we may need\n    // to error during build if we fail to insert it for some reason.\n    return originalHtml\n  }\n  // The comment must be inserted after the doctype.\n  return originalHtml.replace(\n    DOCTYPE_PREFIX,\n    DOCTYPE_PREFIX + '<!--' + escapeBuildId(buildId) + '-->'\n  )\n}\n","import { hexHash } from '../../hash'\n\nexport function computeCacheBustingSearchParam(\n  prefetchHeader: '1' | '2' | '0' | undefined,\n  segmentPrefetchHeader: string | string[] | undefined,\n  stateTreeHeader: string | string[] | undefined,\n  nextUrlHeader: string | string[] | undefined\n): string {\n  if (\n    (prefetchHeader === undefined || prefetchHeader === '0') &&\n    segmentPrefetchHeader === undefined &&\n    stateTreeHeader === undefined &&\n    nextUrlHeader === undefined\n  ) {\n    return ''\n  }\n  return hexHash(\n    [\n      prefetchHeader || '0',\n      segmentPrefetchHeader || '0',\n      stateTreeHeader || '0',\n      nextUrlHeader || '0',\n    ].join(',')\n  )\n}\n","import type { ReactDOMServerReadableStream } from 'react-dom/server'\nimport { getTracer } from '../lib/trace/tracer'\nimport { AppRenderSpan } from '../lib/trace/constants'\nimport { DetachedPromise } from '../../lib/detached-promise'\nimport {\n  scheduleImmediate,\n  atLeastOneTask,\n  waitAtLeastOneReactRenderTask,\n} from '../../lib/scheduler'\nimport { ENCODED_TAGS } from './encoded-tags'\nimport {\n  indexOfUint8Array,\n  isEquivalentUint8Arrays,\n  removeFromUint8Array,\n} from './uint8array-helpers'\nimport { MISSING_ROOT_TAGS_ERROR } from '../../shared/lib/errors/constants'\nimport { insertBuildIdComment } from '../../shared/lib/segment-cache/output-export-prefetch-encoding'\nimport {\n  RSC_HEADER,\n  NEXT_ROUTER_PREFETCH_HEADER,\n  NEXT_ROUTER_SEGMENT_PREFETCH_HEADER,\n  NEXT_RSC_UNION_QUERY,\n} from '../../client/components/app-router-headers'\nimport { computeCacheBustingSearchParam } from '../../shared/lib/router/utils/cache-busting-search-param'\n\nfunction voidCatch() {\n  // this catcher is designed to be used with pipeTo where we expect the underlying\n  // pipe implementation to forward errors but we don't want the pipeTo promise to reject\n  // and be unhandled\n}\n\n// We can share the same encoder instance everywhere\n// Notably we cannot do the same for TextDecoder because it is stateful\n// when handling streaming data\nconst encoder = new TextEncoder()\n\nexport function chainStreams<T>(\n  ...streams: ReadableStream<T>[]\n): ReadableStream<T> {\n  // If we have no streams, return an empty stream. This behavior is\n  // intentional as we're now providing the `RenderResult.EMPTY` value.\n  if (streams.length === 0) {\n    return new ReadableStream<T>({\n      start(controller) {\n        controller.close()\n      },\n    })\n  }\n\n  // If we only have 1 stream we fast path it by returning just this stream\n  if (streams.length === 1) {\n    return streams[0]\n  }\n\n  const { readable, writable } = new TransformStream()\n\n  // We always initiate pipeTo immediately. We know we have at least 2 streams\n  // so we need to avoid closing the writable when this one finishes.\n  let promise = streams[0].pipeTo(writable, { preventClose: true })\n\n  let i = 1\n  for (; i < streams.length - 1; i++) {\n    const nextStream = streams[i]\n    promise = promise.then(() =>\n      nextStream.pipeTo(writable, { preventClose: true })\n    )\n  }\n\n  // We can omit the length check because we halted before the last stream and there\n  // is at least two streams so the lastStream here will always be defined\n  const lastStream = streams[i]\n  promise = promise.then(() => lastStream.pipeTo(writable))\n\n  // Catch any errors from the streams and ignore them, they will be handled\n  // by whatever is consuming the readable stream.\n  promise.catch(voidCatch)\n\n  return readable\n}\n\nexport function streamFromString(str: string): ReadableStream<Uint8Array> {\n  return new ReadableStream({\n    start(controller) {\n      controller.enqueue(encoder.encode(str))\n      controller.close()\n    },\n  })\n}\n\nexport function streamFromBuffer(chunk: Buffer): ReadableStream<Uint8Array> {\n  return new ReadableStream({\n    start(controller) {\n      controller.enqueue(chunk)\n      controller.close()\n    },\n  })\n}\n\nasync function streamToChunks(\n  stream: ReadableStream<Uint8Array>\n): Promise<Array<Uint8Array>> {\n  const reader = stream.getReader()\n  const chunks: Array<Uint8Array> = []\n\n  while (true) {\n    const { done, value } = await reader.read()\n    if (done) {\n      break\n    }\n\n    chunks.push(value)\n  }\n\n  return chunks\n}\n\nfunction concatUint8Arrays(chunks: Array<Uint8Array>): Uint8Array {\n  const totalLength = chunks.reduce((sum, chunk) => sum + chunk.length, 0)\n  const result = new Uint8Array(totalLength)\n  let offset = 0\n  for (const chunk of chunks) {\n    result.set(chunk, offset)\n    offset += chunk.length\n  }\n  return result\n}\n\nexport async function streamToUint8Array(\n  stream: ReadableStream<Uint8Array>\n): Promise<Uint8Array> {\n  return concatUint8Arrays(await streamToChunks(stream))\n}\n\nexport async function streamToBuffer(\n  stream: ReadableStream<Uint8Array>\n): Promise<Buffer> {\n  return Buffer.concat(await streamToChunks(stream))\n}\n\nexport async function streamToString(\n  stream: ReadableStream<Uint8Array>,\n  signal?: AbortSignal\n): Promise<string> {\n  const decoder = new TextDecoder('utf-8', { fatal: true })\n  let string = ''\n\n  for await (const chunk of stream) {\n    if (signal?.aborted) {\n      return string\n    }\n\n    string += decoder.decode(chunk, { stream: true })\n  }\n\n  string += decoder.decode()\n\n  return string\n}\n\nexport type BufferedTransformOptions = {\n  /**\n   * Flush synchronously once the buffer reaches this many bytes.\n   */\n  readonly maxBufferByteLength?: number\n}\n\nexport function createBufferedTransformStream(\n  options: BufferedTransformOptions = {}\n): TransformStream<Uint8Array, Uint8Array> {\n  const { maxBufferByteLength = Infinity } = options\n\n  let bufferedChunks: Array<Uint8Array> = []\n  let bufferByteLength: number = 0\n  let pending: DetachedPromise<void> | undefined\n\n  const flush = (controller: TransformStreamDefaultController) => {\n    try {\n      if (bufferedChunks.length === 0) {\n        return\n      }\n\n      const chunk = new Uint8Array(bufferByteLength)\n      let copiedBytes = 0\n\n      for (let i = 0; i < bufferedChunks.length; i++) {\n        const bufferedChunk = bufferedChunks[i]\n        chunk.set(bufferedChunk, copiedBytes)\n        copiedBytes += bufferedChunk.byteLength\n      }\n      // We just wrote all the buffered chunks so we need to reset the bufferedChunks array\n      // and our bufferByteLength to prepare for the next round of buffered chunks\n      bufferedChunks.length = 0\n      bufferByteLength = 0\n      controller.enqueue(chunk)\n    } catch {\n      // If an error occurs while enqueuing, it can't be due to this\n      // transformer. It's most likely caused by the controller having been\n      // errored (for example, if the stream was cancelled).\n    }\n  }\n\n  const scheduleFlush = (controller: TransformStreamDefaultController) => {\n    if (pending) {\n      return\n    }\n\n    const detached = new DetachedPromise<void>()\n    pending = detached\n\n    scheduleImmediate(() => {\n      try {\n        flush(controller)\n      } finally {\n        pending = undefined\n        detached.resolve()\n      }\n    })\n  }\n\n  return new TransformStream({\n    transform(chunk, controller) {\n      // Combine the previous buffer with the new chunk.\n      bufferedChunks.push(chunk)\n      bufferByteLength += chunk.byteLength\n\n      if (bufferByteLength >= maxBufferByteLength) {\n        flush(controller)\n      } else {\n        scheduleFlush(controller)\n      }\n    },\n    flush() {\n      return pending?.promise\n    },\n  })\n}\n\nfunction createPrefetchCommentStream(\n  isBuildTimePrerendering: boolean,\n  buildId: string\n): TransformStream<Uint8Array, Uint8Array> {\n  // Insert an extra comment at the beginning of the HTML document. This must\n  // come after the DOCTYPE, which is inserted by React.\n  //\n  // The first chunk sent by React will contain the doctype. After that, we can\n  // pass through the rest of the chunks as-is.\n  let didTransformFirstChunk = false\n  return new TransformStream({\n    transform(chunk, controller) {\n      if (isBuildTimePrerendering && !didTransformFirstChunk) {\n        didTransformFirstChunk = true\n        const decoder = new TextDecoder('utf-8', { fatal: true })\n        const chunkStr = decoder.decode(chunk, {\n          stream: true,\n        })\n        const updatedChunkStr = insertBuildIdComment(chunkStr, buildId)\n        controller.enqueue(encoder.encode(updatedChunkStr))\n        return\n      }\n      controller.enqueue(chunk)\n    },\n  })\n}\n\nexport function renderToInitialFizzStream({\n  ReactDOMServer,\n  element,\n  streamOptions,\n}: {\n  ReactDOMServer: {\n    renderToReadableStream: typeof import('react-dom/server').renderToReadableStream\n  }\n  element: React.ReactElement\n  streamOptions?: Parameters<typeof ReactDOMServer.renderToReadableStream>[1]\n}): Promise<ReactDOMServerReadableStream> {\n  return getTracer().trace(AppRenderSpan.renderToReadableStream, async () =>\n    ReactDOMServer.renderToReadableStream(element, streamOptions)\n  )\n}\n\nfunction createMetadataTransformStream(\n  insert: () => Promise<string> | string\n): TransformStream<Uint8Array, Uint8Array> {\n  let chunkIndex = -1\n  let isMarkRemoved = false\n\n  return new TransformStream({\n    async transform(chunk, controller) {\n      let iconMarkIndex = -1\n      let closedHeadIndex = -1\n      chunkIndex++\n\n      if (isMarkRemoved) {\n        controller.enqueue(chunk)\n        return\n      }\n      let iconMarkLength = 0\n      // Only search for the closed head tag once\n      if (iconMarkIndex === -1) {\n        iconMarkIndex = indexOfUint8Array(chunk, ENCODED_TAGS.META.ICON_MARK)\n        if (iconMarkIndex === -1) {\n          controller.enqueue(chunk)\n          return\n        } else {\n          // When we found the `<meta name=\"«nxt-icon»\"` tag prefix, we will remove it from the chunk.\n          // Its close tag could either be `/>` or `>`, checking the next char to ensure we cover both cases.\n          iconMarkLength = ENCODED_TAGS.META.ICON_MARK.length\n          // Check if next char is /, this is for xml mode.\n          if (chunk[iconMarkIndex + iconMarkLength] === 47) {\n            iconMarkLength += 2\n          } else {\n            // The last char is `>`\n            iconMarkLength++\n          }\n        }\n      }\n\n      // Check if icon mark is inside <head> tag in the first chunk.\n      if (chunkIndex === 0) {\n        closedHeadIndex = indexOfUint8Array(chunk, ENCODED_TAGS.CLOSED.HEAD)\n        if (iconMarkIndex !== -1) {\n          // The mark icon is located in the 1st chunk before the head tag.\n          // We do not need to insert the script tag in this case because it's in the head.\n          // Just remove the icon mark from the chunk.\n          if (iconMarkIndex < closedHeadIndex) {\n            const replaced = new Uint8Array(chunk.length - iconMarkLength)\n\n            // Remove the icon mark from the chunk.\n            replaced.set(chunk.subarray(0, iconMarkIndex))\n            replaced.set(\n              chunk.subarray(iconMarkIndex + iconMarkLength),\n              iconMarkIndex\n            )\n            chunk = replaced\n          } else {\n            // The icon mark is after the head tag, replace and insert the script tag at that position.\n            const insertion = await insert()\n            const encodedInsertion = encoder.encode(insertion)\n            const insertionLength = encodedInsertion.length\n            const replaced = new Uint8Array(\n              chunk.length - iconMarkLength + insertionLength\n            )\n            replaced.set(chunk.subarray(0, iconMarkIndex))\n            replaced.set(encodedInsertion, iconMarkIndex)\n            replaced.set(\n              chunk.subarray(iconMarkIndex + iconMarkLength),\n              iconMarkIndex + insertionLength\n            )\n            chunk = replaced\n          }\n          isMarkRemoved = true\n        }\n        // If there's no icon mark located, it will be handled later when if present in the following chunks.\n      } else {\n        // When it's appeared in the following chunks, we'll need to\n        // remove the mark and then insert the script tag at that position.\n        const insertion = await insert()\n        const encodedInsertion = encoder.encode(insertion)\n        const insertionLength = encodedInsertion.length\n        // Replace the icon mark with the hoist script or empty string.\n        const replaced = new Uint8Array(\n          chunk.length - iconMarkLength + insertionLength\n        )\n        // Set the first part of the chunk, before the icon mark.\n        replaced.set(chunk.subarray(0, iconMarkIndex))\n        // Set the insertion after the icon mark.\n        replaced.set(encodedInsertion, iconMarkIndex)\n\n        // Set the rest of the chunk after the icon mark.\n        replaced.set(\n          chunk.subarray(iconMarkIndex + iconMarkLength),\n          iconMarkIndex + insertionLength\n        )\n        chunk = replaced\n        isMarkRemoved = true\n      }\n      controller.enqueue(chunk)\n    },\n  })\n}\n\nfunction createHeadInsertionTransformStream(\n  insert: () => Promise<string>\n): TransformStream<Uint8Array, Uint8Array> {\n  let inserted = false\n\n  // We need to track if this transform saw any bytes because if it didn't\n  // we won't want to insert any server HTML at all\n  let hasBytes = false\n\n  return new TransformStream({\n    async transform(chunk, controller) {\n      hasBytes = true\n\n      const insertion = await insert()\n      if (inserted) {\n        if (insertion) {\n          const encodedInsertion = encoder.encode(insertion)\n          controller.enqueue(encodedInsertion)\n        }\n        controller.enqueue(chunk)\n      } else {\n        // TODO (@Ethan-Arrowood): Replace the generic `indexOfUint8Array` method with something finely tuned for the subset of things actually being checked for.\n        const index = indexOfUint8Array(chunk, ENCODED_TAGS.CLOSED.HEAD)\n        // In fully static rendering or non PPR rendering cases:\n        // `/head>` will always be found in the chunk in first chunk rendering.\n        if (index !== -1) {\n          if (insertion) {\n            const encodedInsertion = encoder.encode(insertion)\n            // Get the total count of the bytes in the chunk and the insertion\n            // e.g.\n            // chunk = <head><meta charset=\"utf-8\"></head>\n            // insertion = <script>...</script>\n            // output = <head><meta charset=\"utf-8\"> [ <script>...</script> ] </head>\n            const insertedHeadContent = new Uint8Array(\n              chunk.length + encodedInsertion.length\n            )\n            // Append the first part of the chunk, before the head tag\n            insertedHeadContent.set(chunk.slice(0, index))\n            // Append the server inserted content\n            insertedHeadContent.set(encodedInsertion, index)\n            // Append the rest of the chunk\n            insertedHeadContent.set(\n              chunk.slice(index),\n              index + encodedInsertion.length\n            )\n            controller.enqueue(insertedHeadContent)\n          } else {\n            controller.enqueue(chunk)\n          }\n          inserted = true\n        } else {\n          // This will happens in PPR rendering during next start, when the page is partially rendered.\n          // When the page resumes, the head tag will be found in the middle of the chunk.\n          // Where we just need to append the insertion and chunk to the current stream.\n          // e.g.\n          // PPR-static: <head>...</head><body> [ resume content ] </body>\n          // PPR-resume: [ insertion ] [ rest content ]\n          if (insertion) {\n            controller.enqueue(encoder.encode(insertion))\n          }\n          controller.enqueue(chunk)\n          inserted = true\n        }\n      }\n    },\n    async flush(controller) {\n      // Check before closing if there's anything remaining to insert.\n      if (hasBytes) {\n        const insertion = await insert()\n        if (insertion) {\n          controller.enqueue(encoder.encode(insertion))\n        }\n      }\n    },\n  })\n}\n\nfunction createClientResumeScriptInsertionTransformStream(): TransformStream<\n  Uint8Array,\n  Uint8Array\n> {\n  const segmentPath = '/_full'\n  const cacheBustingHeader = computeCacheBustingSearchParam(\n    '1', //            headers[NEXT_ROUTER_PREFETCH_HEADER]\n    '/_full', //       headers[NEXT_ROUTER_SEGMENT_PREFETCH_HEADER]\n    undefined, //      headers[NEXT_ROUTER_STATE_TREE_HEADER]\n    undefined //       headers[NEXT_URL]\n  )\n  const searchStr = `${NEXT_RSC_UNION_QUERY}=${cacheBustingHeader}`\n  const NEXT_CLIENT_RESUME_SCRIPT = `<script>__NEXT_CLIENT_RESUME=fetch(location.pathname+'?${searchStr}',{credentials:'same-origin',headers:{'${RSC_HEADER}': '1','${NEXT_ROUTER_PREFETCH_HEADER}': '1','${NEXT_ROUTER_SEGMENT_PREFETCH_HEADER}': '${segmentPath}'}})</script>`\n\n  let didAlreadyInsert = false\n  return new TransformStream({\n    transform(chunk, controller) {\n      if (didAlreadyInsert) {\n        // Already inserted the script into the head. Pass through.\n        controller.enqueue(chunk)\n        return\n      }\n      // TODO (@Ethan-Arrowood): Replace the generic `indexOfUint8Array` method with something finely tuned for the subset of things actually being checked for.\n      const headClosingTagIndex = indexOfUint8Array(\n        chunk,\n        ENCODED_TAGS.CLOSED.HEAD\n      )\n\n      if (headClosingTagIndex === -1) {\n        // In fully static rendering or non PPR rendering cases:\n        // `/head>` will always be found in the chunk in first chunk rendering.\n        controller.enqueue(chunk)\n        return\n      }\n\n      const encodedInsertion = encoder.encode(NEXT_CLIENT_RESUME_SCRIPT)\n      // Get the total count of the bytes in the chunk and the insertion\n      // e.g.\n      // chunk = <head><meta charset=\"utf-8\"></head>\n      // insertion = <script>...</script>\n      // output = <head><meta charset=\"utf-8\"> [ <script>...</script> ] </head>\n      const insertedHeadContent = new Uint8Array(\n        chunk.length + encodedInsertion.length\n      )\n      // Append the first part of the chunk, before the head tag\n      insertedHeadContent.set(chunk.slice(0, headClosingTagIndex))\n      // Append the server inserted content\n      insertedHeadContent.set(encodedInsertion, headClosingTagIndex)\n      // Append the rest of the chunk\n      insertedHeadContent.set(\n        chunk.slice(headClosingTagIndex),\n        headClosingTagIndex + encodedInsertion.length\n      )\n\n      controller.enqueue(insertedHeadContent)\n      didAlreadyInsert = true\n    },\n  })\n}\n\n// Suffix after main body content - scripts before </body>,\n// but wait for the major chunks to be enqueued.\nfunction createDeferredSuffixStream(\n  suffix: string\n): TransformStream<Uint8Array, Uint8Array> {\n  let flushed = false\n  let pending: DetachedPromise<void> | undefined\n\n  const flush = (controller: TransformStreamDefaultController) => {\n    const detached = new DetachedPromise<void>()\n    pending = detached\n\n    scheduleImmediate(() => {\n      try {\n        controller.enqueue(encoder.encode(suffix))\n      } catch {\n        // If an error occurs while enqueuing it can't be due to this\n        // transformers fault. It's likely due to the controller being\n        // errored due to the stream being cancelled.\n      } finally {\n        pending = undefined\n        detached.resolve()\n      }\n    })\n  }\n\n  return new TransformStream({\n    transform(chunk, controller) {\n      controller.enqueue(chunk)\n\n      // If we've already flushed, we're done.\n      if (flushed) return\n\n      // Schedule the flush to happen.\n      flushed = true\n      flush(controller)\n    },\n    flush(controller) {\n      if (pending) return pending.promise\n      if (flushed) return\n\n      // Flush now.\n      controller.enqueue(encoder.encode(suffix))\n    },\n  })\n}\n\nfunction createFlightDataInjectionTransformStream(\n  stream: ReadableStream<Uint8Array>,\n  delayDataUntilFirstHtmlChunk: boolean\n): TransformStream<Uint8Array, Uint8Array> {\n  let htmlStreamFinished = false\n\n  let pull: Promise<void> | null = null\n  let donePulling = false\n\n  function startOrContinuePulling(\n    controller: TransformStreamDefaultController\n  ) {\n    if (!pull) {\n      pull = startPulling(controller)\n    }\n    return pull\n  }\n\n  async function startPulling(controller: TransformStreamDefaultController) {\n    const reader = stream.getReader()\n\n    if (delayDataUntilFirstHtmlChunk) {\n      // NOTE: streaming flush\n      // We are buffering here for the inlined data stream because the\n      // \"shell\" stream might be chunkenized again by the underlying stream\n      // implementation, e.g. with a specific high-water mark. To ensure it's\n      // the safe timing to pipe the data stream, this extra tick is\n      // necessary.\n\n      // We don't start reading until we've left the current Task to ensure\n      // that it's inserted after flushing the shell. Note that this implementation\n      // might get stale if impl details of Fizz change in the future.\n      await atLeastOneTask()\n    }\n\n    try {\n      while (true) {\n        const { done, value } = await reader.read()\n        if (done) {\n          donePulling = true\n          return\n        }\n\n        // We want to prioritize HTML over RSC data.\n        // The SSR render is based on the same RSC stream, so when we get a new RSC chunk,\n        // we're likely to produce an HTML chunk as well, so give it a chance to flush first.\n        if (!delayDataUntilFirstHtmlChunk && !htmlStreamFinished) {\n          await atLeastOneTask()\n        }\n        controller.enqueue(value)\n      }\n    } catch (err) {\n      controller.error(err)\n    }\n  }\n\n  return new TransformStream({\n    start(controller) {\n      if (!delayDataUntilFirstHtmlChunk) {\n        startOrContinuePulling(controller)\n      }\n    },\n    transform(chunk, controller) {\n      controller.enqueue(chunk)\n\n      // Start the streaming if it hasn't already been started yet.\n      if (delayDataUntilFirstHtmlChunk) {\n        startOrContinuePulling(controller)\n      }\n    },\n    flush(controller) {\n      htmlStreamFinished = true\n      if (donePulling) {\n        return\n      }\n      return startOrContinuePulling(controller)\n    },\n  })\n}\n\nconst CLOSE_TAG = '</body></html>'\n\n/**\n * This transform stream moves the suffix to the end of the stream, so results\n * like `</body></html><script>...</script>` will be transformed to\n * `<script>...</script></body></html>`.\n */\nfunction createMoveSuffixStream(): TransformStream<Uint8Array, Uint8Array> {\n  let foundSuffix = false\n\n  return new TransformStream({\n    transform(chunk, controller) {\n      if (foundSuffix) {\n        return controller.enqueue(chunk)\n      }\n\n      const index = indexOfUint8Array(chunk, ENCODED_TAGS.CLOSED.BODY_AND_HTML)\n      if (index > -1) {\n        foundSuffix = true\n\n        // If the whole chunk is the suffix, then don't write anything, it will\n        // be written in the flush.\n        if (chunk.length === ENCODED_TAGS.CLOSED.BODY_AND_HTML.length) {\n          return\n        }\n\n        // Write out the part before the suffix.\n        const before = chunk.slice(0, index)\n        controller.enqueue(before)\n\n        // In the case where the suffix is in the middle of the chunk, we need\n        // to split the chunk into two parts.\n        if (chunk.length > ENCODED_TAGS.CLOSED.BODY_AND_HTML.length + index) {\n          // Write out the part after the suffix.\n          const after = chunk.slice(\n            index + ENCODED_TAGS.CLOSED.BODY_AND_HTML.length\n          )\n          controller.enqueue(after)\n        }\n      } else {\n        controller.enqueue(chunk)\n      }\n    },\n    flush(controller) {\n      // Even if we didn't find the suffix, the HTML is not valid if we don't\n      // add it, so insert it at the end.\n      controller.enqueue(ENCODED_TAGS.CLOSED.BODY_AND_HTML)\n    },\n  })\n}\n\nfunction createStripDocumentClosingTagsTransform(): TransformStream<\n  Uint8Array,\n  Uint8Array\n> {\n  return new TransformStream({\n    transform(chunk, controller) {\n      // We rely on the assumption that chunks will never break across a code unit.\n      // This is reasonable because we currently concat all of React's output from a single\n      // flush into one chunk before streaming it forward which means the chunk will represent\n      // a single coherent utf-8 string. This is not safe to use if we change our streaming to no\n      // longer do this large buffered chunk\n      if (\n        isEquivalentUint8Arrays(chunk, ENCODED_TAGS.CLOSED.BODY_AND_HTML) ||\n        isEquivalentUint8Arrays(chunk, ENCODED_TAGS.CLOSED.BODY) ||\n        isEquivalentUint8Arrays(chunk, ENCODED_TAGS.CLOSED.HTML)\n      ) {\n        // the entire chunk is the closing tags; return without enqueueing anything.\n        return\n      }\n\n      // We assume these tags will go at together at the end of the document and that\n      // they won't appear anywhere else in the document. This is not really a safe assumption\n      // but until we revamp our streaming infra this is a performant way to string the tags\n      chunk = removeFromUint8Array(chunk, ENCODED_TAGS.CLOSED.BODY)\n      chunk = removeFromUint8Array(chunk, ENCODED_TAGS.CLOSED.HTML)\n\n      controller.enqueue(chunk)\n    },\n  })\n}\n\n/*\n * Checks if the root layout is missing the html or body tags\n * and if so, it will inject a script tag to throw an error in the browser, showing the user\n * the error message in the error overlay.\n */\nexport function createRootLayoutValidatorStream(): TransformStream<\n  Uint8Array,\n  Uint8Array\n> {\n  let foundHtml = false\n  let foundBody = false\n  return new TransformStream({\n    async transform(chunk, controller) {\n      // Peek into the streamed chunk to see if the tags are present.\n      if (\n        !foundHtml &&\n        indexOfUint8Array(chunk, ENCODED_TAGS.OPENING.HTML) > -1\n      ) {\n        foundHtml = true\n      }\n\n      if (\n        !foundBody &&\n        indexOfUint8Array(chunk, ENCODED_TAGS.OPENING.BODY) > -1\n      ) {\n        foundBody = true\n      }\n\n      controller.enqueue(chunk)\n    },\n    flush(controller) {\n      const missingTags: ('html' | 'body')[] = []\n      if (!foundHtml) missingTags.push('html')\n      if (!foundBody) missingTags.push('body')\n\n      if (!missingTags.length) return\n\n      controller.enqueue(\n        encoder.encode(\n          `<html id=\"__next_error__\">\n            <template\n              data-next-error-message=\"Missing ${missingTags\n                .map((c) => `<${c}>`)\n                .join(\n                  missingTags.length > 1 ? ' and ' : ''\n                )} tags in the root layout.\\nRead more at https://nextjs.org/docs/messages/missing-root-layout-tags\"\n              data-next-error-digest=\"${MISSING_ROOT_TAGS_ERROR}\"\n              data-next-error-stack=\"\"\n            ></template>\n          `\n        )\n      )\n    },\n  })\n}\n\nfunction chainTransformers<T>(\n  readable: ReadableStream<T>,\n  transformers: ReadonlyArray<TransformStream<T, T> | null>\n): ReadableStream<T> {\n  let stream = readable\n  for (const transformer of transformers) {\n    if (!transformer) continue\n\n    stream = stream.pipeThrough(transformer)\n  }\n  return stream\n}\n\nexport type ContinueStreamOptions = {\n  inlinedDataStream: ReadableStream<Uint8Array> | undefined\n  isStaticGeneration: boolean\n  isBuildTimePrerendering: boolean\n  buildId: string\n  getServerInsertedHTML: () => Promise<string>\n  getServerInsertedMetadata: () => Promise<string>\n  validateRootLayout?: boolean\n  /**\n   * Suffix to inject after the buffered data, but before the close tags.\n   */\n  suffix?: string | undefined\n}\n\nexport async function continueFizzStream(\n  renderStream: ReactDOMServerReadableStream,\n  {\n    suffix,\n    inlinedDataStream,\n    isStaticGeneration,\n    isBuildTimePrerendering,\n    buildId,\n    getServerInsertedHTML,\n    getServerInsertedMetadata,\n    validateRootLayout,\n  }: ContinueStreamOptions\n): Promise<ReadableStream<Uint8Array>> {\n  // Suffix itself might contain close tags at the end, so we need to split it.\n  const suffixUnclosed = suffix ? suffix.split(CLOSE_TAG, 1)[0] : null\n\n  if (isStaticGeneration) {\n    // If we're generating static HTML we need to wait for it to resolve before continuing.\n    await renderStream.allReady\n  } else {\n    // Otherwise, we want to make sure Fizz is done with all microtasky work\n    // before we start pulling the stream and cause a flush.\n    await waitAtLeastOneReactRenderTask()\n  }\n\n  return chainTransformers(renderStream, [\n    // Buffer everything to avoid flushing too frequently\n    createBufferedTransformStream(),\n\n    // Add build id comment to start of the HTML document (in export mode)\n    createPrefetchCommentStream(isBuildTimePrerendering, buildId),\n\n    // Transform metadata\n    createMetadataTransformStream(getServerInsertedMetadata),\n\n    // Insert suffix content\n    suffixUnclosed != null && suffixUnclosed.length > 0\n      ? createDeferredSuffixStream(suffixUnclosed)\n      : null,\n\n    // Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n    inlinedDataStream\n      ? createFlightDataInjectionTransformStream(inlinedDataStream, true)\n      : null,\n\n    // Validate the root layout for missing html or body tags\n    validateRootLayout ? createRootLayoutValidatorStream() : null,\n\n    // Close tags should always be deferred to the end\n    createMoveSuffixStream(),\n\n    // Special head insertions\n    // TODO-APP: Insert server side html to end of head in app layout rendering, to avoid\n    // hydration errors. Remove this once it's ready to be handled by react itself.\n    createHeadInsertionTransformStream(getServerInsertedHTML),\n  ])\n}\n\ntype ContinueDynamicPrerenderOptions = {\n  getServerInsertedHTML: () => Promise<string>\n  getServerInsertedMetadata: () => Promise<string>\n}\n\nexport async function continueDynamicPrerender(\n  prerenderStream: ReadableStream<Uint8Array>,\n  {\n    getServerInsertedHTML,\n    getServerInsertedMetadata,\n  }: ContinueDynamicPrerenderOptions\n) {\n  return (\n    prerenderStream\n      // Buffer everything to avoid flushing too frequently\n      .pipeThrough(createBufferedTransformStream())\n      .pipeThrough(createStripDocumentClosingTagsTransform())\n      // Insert generated tags to head\n      .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))\n      // Transform metadata\n      .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))\n  )\n}\n\ntype ContinueStaticPrerenderOptions = {\n  inlinedDataStream: ReadableStream<Uint8Array>\n  getServerInsertedHTML: () => Promise<string>\n  getServerInsertedMetadata: () => Promise<string>\n  isBuildTimePrerendering: boolean\n  buildId: string\n}\n\nexport async function continueStaticPrerender(\n  prerenderStream: ReadableStream<Uint8Array>,\n  {\n    inlinedDataStream,\n    getServerInsertedHTML,\n    getServerInsertedMetadata,\n    isBuildTimePrerendering,\n    buildId,\n  }: ContinueStaticPrerenderOptions\n) {\n  return (\n    prerenderStream\n      // Buffer everything to avoid flushing too frequently\n      .pipeThrough(createBufferedTransformStream())\n      // Add build id comment to start of the HTML document (in export mode)\n      .pipeThrough(\n        createPrefetchCommentStream(isBuildTimePrerendering, buildId)\n      )\n      // Insert generated tags to head\n      .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))\n      // Transform metadata\n      .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))\n      // Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n      .pipeThrough(\n        createFlightDataInjectionTransformStream(inlinedDataStream, true)\n      )\n      // Close tags should always be deferred to the end\n      .pipeThrough(createMoveSuffixStream())\n  )\n}\n\nexport async function continueStaticFallbackPrerender(\n  prerenderStream: ReadableStream<Uint8Array>,\n  {\n    inlinedDataStream,\n    getServerInsertedHTML,\n    getServerInsertedMetadata,\n    isBuildTimePrerendering,\n    buildId,\n  }: ContinueStaticPrerenderOptions\n) {\n  // Same as `continueStaticPrerender`, but also inserts an additional script\n  // to instruct the client to start fetching the hydration data as early\n  // as possible.\n  return (\n    prerenderStream\n      // Buffer everything to avoid flushing too frequently\n      .pipeThrough(createBufferedTransformStream())\n      // Add build id comment to start of the HTML document (in export mode)\n      .pipeThrough(\n        createPrefetchCommentStream(isBuildTimePrerendering, buildId)\n      )\n      // Insert generated tags to head\n      .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))\n      // Insert the client resume script into the head\n      .pipeThrough(createClientResumeScriptInsertionTransformStream())\n      // Transform metadata\n      .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))\n      // Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n      .pipeThrough(\n        createFlightDataInjectionTransformStream(inlinedDataStream, true)\n      )\n      // Close tags should always be deferred to the end\n      .pipeThrough(createMoveSuffixStream())\n  )\n}\n\ntype ContinueResumeOptions = {\n  inlinedDataStream: ReadableStream<Uint8Array>\n  getServerInsertedHTML: () => Promise<string>\n  getServerInsertedMetadata: () => Promise<string>\n  delayDataUntilFirstHtmlChunk: boolean\n}\n\nexport async function continueDynamicHTMLResume(\n  renderStream: ReadableStream<Uint8Array>,\n  {\n    delayDataUntilFirstHtmlChunk,\n    inlinedDataStream,\n    getServerInsertedHTML,\n    getServerInsertedMetadata,\n  }: ContinueResumeOptions\n) {\n  return (\n    renderStream\n      // Buffer everything to avoid flushing too frequently\n      .pipeThrough(createBufferedTransformStream())\n      // Insert generated tags to head\n      .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))\n      // Transform metadata\n      .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))\n      // Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n      .pipeThrough(\n        createFlightDataInjectionTransformStream(\n          inlinedDataStream,\n          delayDataUntilFirstHtmlChunk\n        )\n      )\n      // Close tags should always be deferred to the end\n      .pipeThrough(createMoveSuffixStream())\n  )\n}\n\nexport function createDocumentClosingStream(): ReadableStream<Uint8Array> {\n  return streamFromString(CLOSE_TAG)\n}\n","const DYNAMIC_ERROR_CODE = 'DYNAMIC_SERVER_USAGE'\n\nexport class DynamicServerError extends Error {\n  digest: typeof DYNAMIC_ERROR_CODE = DYNAMIC_ERROR_CODE\n\n  constructor(public readonly description: string) {\n    super(`Dynamic server usage: ${description}`)\n  }\n}\n\nexport function isDynamicServerError(err: unknown): err is DynamicServerError {\n  if (\n    typeof err !== 'object' ||\n    err === null ||\n    !('digest' in err) ||\n    typeof err.digest !== 'string'\n  ) {\n    return false\n  }\n\n  return err.digest === DYNAMIC_ERROR_CODE\n}\n","const NEXT_STATIC_GEN_BAILOUT = 'NEXT_STATIC_GEN_BAILOUT'\n\nexport class StaticGenBailoutError extends Error {\n  public readonly code = NEXT_STATIC_GEN_BAILOUT\n}\n\nexport function isStaticGenBailoutError(\n  error: unknown\n): error is StaticGenBailoutError {\n  if (typeof error !== 'object' || error === null || !('code' in error)) {\n    return false\n  }\n\n  return error.code === NEXT_STATIC_GEN_BAILOUT\n}\n","export const METADATA_BOUNDARY_NAME = '__next_metadata_boundary__'\nexport const VIEWPORT_BOUNDARY_NAME = '__next_viewport_boundary__'\nexport const OUTLET_BOUNDARY_NAME = '__next_outlet_boundary__'\nexport const ROOT_LAYOUT_BOUNDARY_NAME = '__next_root_layout_boundary__'\n","// This has to be a shared module which is shared between client component error boundary and dynamic component\nconst BAILOUT_TO_CSR = 'BAILOUT_TO_CLIENT_SIDE_RENDERING'\n\n/** An error that should be thrown when we want to bail out to client-side rendering. */\nexport class BailoutToCSRError extends Error {\n  public readonly digest = BAILOUT_TO_CSR\n\n  constructor(public readonly reason: string) {\n    super(`Bail out to client-side rendering: ${reason}`)\n  }\n}\n\n/** Checks if a passed argument is an error that is thrown if we want to bail out to client-side rendering. */\nexport function isBailoutToCSRError(err: unknown): err is BailoutToCSRError {\n  if (typeof err !== 'object' || err === null || !('digest' in err)) {\n    return false\n  }\n\n  return err.digest === BAILOUT_TO_CSR\n}\n","/**\n * The functions provided by this module are used to communicate certain properties\n * about the currently running code so that Next.js can make decisions on how to handle\n * the current execution in different rendering modes such as pre-rendering, resuming, and SSR.\n *\n * Today Next.js treats all code as potentially static. Certain APIs may only make sense when dynamically rendering.\n * Traditionally this meant deopting the entire render to dynamic however with PPR we can now deopt parts\n * of a React tree as dynamic while still keeping other parts static. There are really two different kinds of\n * Dynamic indications.\n *\n * The first is simply an intention to be dynamic. unstable_noStore is an example of this where\n * the currently executing code simply declares that the current scope is dynamic but if you use it\n * inside unstable_cache it can still be cached. This type of indication can be removed if we ever\n * make the default dynamic to begin with because the only way you would ever be static is inside\n * a cache scope which this indication does not affect.\n *\n * The second is an indication that a dynamic data source was read. This is a stronger form of dynamic\n * because it means that it is inappropriate to cache this at all. using a dynamic data source inside\n * unstable_cache should error. If you want to use some dynamic data inside unstable_cache you should\n * read that data outside the cache and pass it in as an argument to the cached function.\n */\n\nimport type { WorkStore } from '../app-render/work-async-storage.external'\nimport type {\n  WorkUnitStore,\n  PrerenderStoreLegacy,\n  PrerenderStoreModern,\n  PrerenderStoreModernRuntime,\n} from '../app-render/work-unit-async-storage.external'\n\n// Once postpone is in stable we should switch to importing the postpone export directly\nimport React from 'react'\n\nimport { DynamicServerError } from '../../client/components/hooks-server-context'\nimport { StaticGenBailoutError } from '../../client/components/static-generation-bailout'\nimport {\n  getRuntimeStagePromise,\n  throwForMissingRequestStore,\n  workUnitAsyncStorage,\n} from './work-unit-async-storage.external'\nimport { workAsyncStorage } from '../app-render/work-async-storage.external'\nimport { makeHangingPromise } from '../dynamic-rendering-utils'\nimport {\n  METADATA_BOUNDARY_NAME,\n  VIEWPORT_BOUNDARY_NAME,\n  OUTLET_BOUNDARY_NAME,\n  ROOT_LAYOUT_BOUNDARY_NAME,\n} from '../../lib/framework/boundary-constants'\nimport { scheduleOnNextTick } from '../../lib/scheduler'\nimport { BailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr'\nimport { InvariantError } from '../../shared/lib/invariant-error'\n\nconst hasPostpone = typeof React.unstable_postpone === 'function'\n\nexport type DynamicAccess = {\n  /**\n   * If debugging, this will contain the stack trace of where the dynamic access\n   * occurred. This is used to provide more information to the user about why\n   * their page is being rendered dynamically.\n   */\n  stack?: string\n\n  /**\n   * The expression that was accessed dynamically.\n   */\n  expression: string\n}\n\n// Stores dynamic reasons used during an RSC render.\nexport type DynamicTrackingState = {\n  /**\n   * When true, stack information will also be tracked during dynamic access.\n   */\n  readonly isDebugDynamicAccesses: boolean | undefined\n\n  /**\n   * The dynamic accesses that occurred during the render.\n   */\n  readonly dynamicAccesses: Array<DynamicAccess>\n\n  syncDynamicErrorWithStack: null | Error\n}\n\n// Stores dynamic reasons used during an SSR render.\nexport type DynamicValidationState = {\n  hasSuspenseAboveBody: boolean\n  hasDynamicMetadata: boolean\n  dynamicMetadata: null | Error\n  hasDynamicViewport: boolean\n  hasAllowedDynamic: boolean\n  dynamicErrors: Array<Error>\n}\n\nexport function createDynamicTrackingState(\n  isDebugDynamicAccesses: boolean | undefined\n): DynamicTrackingState {\n  return {\n    isDebugDynamicAccesses,\n    dynamicAccesses: [],\n    syncDynamicErrorWithStack: null,\n  }\n}\n\nexport function createDynamicValidationState(): DynamicValidationState {\n  return {\n    hasSuspenseAboveBody: false,\n    hasDynamicMetadata: false,\n    dynamicMetadata: null,\n    hasDynamicViewport: false,\n    hasAllowedDynamic: false,\n    dynamicErrors: [],\n  }\n}\n\nexport function getFirstDynamicReason(\n  trackingState: DynamicTrackingState\n): undefined | string {\n  return trackingState.dynamicAccesses[0]?.expression\n}\n\n/**\n * This function communicates that the current scope should be treated as dynamic.\n *\n * In most cases this function is a no-op but if called during\n * a PPR prerender it will postpone the current sub-tree and calling\n * it during a normal prerender will cause the entire prerender to abort\n */\nexport function markCurrentScopeAsDynamic(\n  store: WorkStore,\n  workUnitStore: undefined | Exclude<WorkUnitStore, PrerenderStoreModern>,\n  expression: string\n): void {\n  if (workUnitStore) {\n    switch (workUnitStore.type) {\n      case 'cache':\n      case 'unstable-cache':\n        // Inside cache scopes, marking a scope as dynamic has no effect,\n        // because the outer cache scope creates a cache boundary. This is\n        // subtly different from reading a dynamic data source, which is\n        // forbidden inside a cache scope.\n        return\n      case 'private-cache':\n        // A private cache scope is already dynamic by definition.\n        return\n      case 'prerender-legacy':\n      case 'prerender-ppr':\n      case 'request':\n        break\n      default:\n        workUnitStore satisfies never\n    }\n  }\n\n  // If we're forcing dynamic rendering or we're forcing static rendering, we\n  // don't need to do anything here because the entire page is already dynamic\n  // or it's static and it should not throw or postpone here.\n  if (store.forceDynamic || store.forceStatic) return\n\n  if (store.dynamicShouldError) {\n    throw new StaticGenBailoutError(\n      `Route ${store.route} with \\`dynamic = \"error\"\\` couldn't be rendered statically because it used \\`${expression}\\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`\n    )\n  }\n\n  if (workUnitStore) {\n    switch (workUnitStore.type) {\n      case 'prerender-ppr':\n        return postponeWithTracking(\n          store.route,\n          expression,\n          workUnitStore.dynamicTracking\n        )\n      case 'prerender-legacy':\n        workUnitStore.revalidate = 0\n\n        // We aren't prerendering, but we are generating a static page. We need\n        // to bail out of static generation.\n        const err = new DynamicServerError(\n          `Route ${store.route} couldn't be rendered statically because it used ${expression}. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`\n        )\n        store.dynamicUsageDescription = expression\n        store.dynamicUsageStack = err.stack\n\n        throw err\n      case 'request':\n        if (process.env.NODE_ENV !== 'production') {\n          workUnitStore.usedDynamic = true\n        }\n        break\n      default:\n        workUnitStore satisfies never\n    }\n  }\n}\n\n/**\n * This function is meant to be used when prerendering without cacheComponents or PPR.\n * When called during a build it will cause Next.js to consider the route as dynamic.\n *\n * @internal\n */\nexport function throwToInterruptStaticGeneration(\n  expression: string,\n  store: WorkStore,\n  prerenderStore: PrerenderStoreLegacy\n): never {\n  // We aren't prerendering but we are generating a static page. We need to bail out of static generation\n  const err = new DynamicServerError(\n    `Route ${store.route} couldn't be rendered statically because it used \\`${expression}\\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`\n  )\n\n  prerenderStore.revalidate = 0\n\n  store.dynamicUsageDescription = expression\n  store.dynamicUsageStack = err.stack\n\n  throw err\n}\n\n/**\n * This function should be used to track whether something dynamic happened even when\n * we are in a dynamic render. This is useful for Dev where all renders are dynamic but\n * we still track whether dynamic APIs were accessed for helpful messaging\n *\n * @internal\n */\nexport function trackDynamicDataInDynamicRender(workUnitStore: WorkUnitStore) {\n  switch (workUnitStore.type) {\n    case 'cache':\n    case 'unstable-cache':\n      // Inside cache scopes, marking a scope as dynamic has no effect,\n      // because the outer cache scope creates a cache boundary. This is\n      // subtly different from reading a dynamic data source, which is\n      // forbidden inside a cache scope.\n      return\n    case 'private-cache':\n      // A private cache scope is already dynamic by definition.\n      return\n    case 'prerender':\n    case 'prerender-runtime':\n    case 'prerender-legacy':\n    case 'prerender-ppr':\n    case 'prerender-client':\n      break\n    case 'request':\n      if (process.env.NODE_ENV !== 'production') {\n        workUnitStore.usedDynamic = true\n      }\n      break\n    default:\n      workUnitStore satisfies never\n  }\n}\n\nfunction abortOnSynchronousDynamicDataAccess(\n  route: string,\n  expression: string,\n  prerenderStore: PrerenderStoreModern\n): void {\n  const reason = `Route ${route} needs to bail out of prerendering at this point because it used ${expression}.`\n\n  const error = createPrerenderInterruptedError(reason)\n\n  prerenderStore.controller.abort(error)\n\n  const dynamicTracking = prerenderStore.dynamicTracking\n  if (dynamicTracking) {\n    dynamicTracking.dynamicAccesses.push({\n      // When we aren't debugging, we don't need to create another error for the\n      // stack trace.\n      stack: dynamicTracking.isDebugDynamicAccesses\n        ? new Error().stack\n        : undefined,\n      expression,\n    })\n  }\n}\n\nexport function abortOnSynchronousPlatformIOAccess(\n  route: string,\n  expression: string,\n  errorWithStack: Error,\n  prerenderStore: PrerenderStoreModern\n): void {\n  const dynamicTracking = prerenderStore.dynamicTracking\n  abortOnSynchronousDynamicDataAccess(route, expression, prerenderStore)\n  // It is important that we set this tracking value after aborting. Aborts are executed\n  // synchronously except for the case where you abort during render itself. By setting this\n  // value late we can use it to determine if any of the aborted tasks are the task that\n  // called the sync IO expression in the first place.\n  if (dynamicTracking) {\n    if (dynamicTracking.syncDynamicErrorWithStack === null) {\n      dynamicTracking.syncDynamicErrorWithStack = errorWithStack\n    }\n  }\n}\n\n/**\n * use this function when prerendering with cacheComponents. If we are doing a\n * prospective prerender we don't actually abort because we want to discover\n * all caches for the shell. If this is the actual prerender we do abort.\n *\n * This function accepts a prerenderStore but the caller should ensure we're\n * actually running in cacheComponents mode.\n *\n * @internal\n */\nexport function abortAndThrowOnSynchronousRequestDataAccess(\n  route: string,\n  expression: string,\n  errorWithStack: Error,\n  prerenderStore: PrerenderStoreModern\n): never {\n  const prerenderSignal = prerenderStore.controller.signal\n  if (prerenderSignal.aborted === false) {\n    // TODO it would be better to move this aborted check into the callsite so we can avoid making\n    // the error object when it isn't relevant to the aborting of the prerender however\n    // since we need the throw semantics regardless of whether we abort it is easier to land\n    // this way. See how this was handled with `abortOnSynchronousPlatformIOAccess` for a closer\n    // to ideal implementation\n    abortOnSynchronousDynamicDataAccess(route, expression, prerenderStore)\n    // It is important that we set this tracking value after aborting. Aborts are executed\n    // synchronously except for the case where you abort during render itself. By setting this\n    // value late we can use it to determine if any of the aborted tasks are the task that\n    // called the sync IO expression in the first place.\n    const dynamicTracking = prerenderStore.dynamicTracking\n    if (dynamicTracking) {\n      if (dynamicTracking.syncDynamicErrorWithStack === null) {\n        dynamicTracking.syncDynamicErrorWithStack = errorWithStack\n      }\n    }\n  }\n  throw createPrerenderInterruptedError(\n    `Route ${route} needs to bail out of prerendering at this point because it used ${expression}.`\n  )\n}\n\n/**\n * This component will call `React.postpone` that throws the postponed error.\n */\ntype PostponeProps = {\n  reason: string\n  route: string\n}\nexport function Postpone({ reason, route }: PostponeProps): never {\n  const prerenderStore = workUnitAsyncStorage.getStore()\n  const dynamicTracking =\n    prerenderStore && prerenderStore.type === 'prerender-ppr'\n      ? prerenderStore.dynamicTracking\n      : null\n  postponeWithTracking(route, reason, dynamicTracking)\n}\n\nexport function postponeWithTracking(\n  route: string,\n  expression: string,\n  dynamicTracking: null | DynamicTrackingState\n): never {\n  assertPostpone()\n  if (dynamicTracking) {\n    dynamicTracking.dynamicAccesses.push({\n      // When we aren't debugging, we don't need to create another error for the\n      // stack trace.\n      stack: dynamicTracking.isDebugDynamicAccesses\n        ? new Error().stack\n        : undefined,\n      expression,\n    })\n  }\n\n  React.unstable_postpone(createPostponeReason(route, expression))\n}\n\nfunction createPostponeReason(route: string, expression: string) {\n  return (\n    `Route ${route} needs to bail out of prerendering at this point because it used ${expression}. ` +\n    `React throws this special object to indicate where. It should not be caught by ` +\n    `your own try/catch. Learn more: https://nextjs.org/docs/messages/ppr-caught-error`\n  )\n}\n\nexport function isDynamicPostpone(err: unknown) {\n  if (\n    typeof err === 'object' &&\n    err !== null &&\n    typeof (err as any).message === 'string'\n  ) {\n    return isDynamicPostponeReason((err as any).message)\n  }\n  return false\n}\n\nfunction isDynamicPostponeReason(reason: string) {\n  return (\n    reason.includes(\n      'needs to bail out of prerendering at this point because it used'\n    ) &&\n    reason.includes(\n      'Learn more: https://nextjs.org/docs/messages/ppr-caught-error'\n    )\n  )\n}\n\nif (isDynamicPostponeReason(createPostponeReason('%%%', '^^^')) === false) {\n  throw new Error(\n    'Invariant: isDynamicPostpone misidentified a postpone reason. This is a bug in Next.js'\n  )\n}\n\nconst NEXT_PRERENDER_INTERRUPTED = 'NEXT_PRERENDER_INTERRUPTED'\n\nfunction createPrerenderInterruptedError(message: string): Error {\n  const error = new Error(message)\n  ;(error as any).digest = NEXT_PRERENDER_INTERRUPTED\n  return error\n}\n\ntype DigestError = Error & {\n  digest: string\n}\n\nexport function isPrerenderInterruptedError(\n  error: unknown\n): error is DigestError {\n  return (\n    typeof error === 'object' &&\n    error !== null &&\n    (error as any).digest === NEXT_PRERENDER_INTERRUPTED &&\n    'name' in error &&\n    'message' in error &&\n    error instanceof Error\n  )\n}\n\nexport function accessedDynamicData(\n  dynamicAccesses: Array<DynamicAccess>\n): boolean {\n  return dynamicAccesses.length > 0\n}\n\nexport function consumeDynamicAccess(\n  serverDynamic: DynamicTrackingState,\n  clientDynamic: DynamicTrackingState\n): DynamicTrackingState['dynamicAccesses'] {\n  // We mutate because we only call this once we are no longer writing\n  // to the dynamicTrackingState and it's more efficient than creating a new\n  // array.\n  serverDynamic.dynamicAccesses.push(...clientDynamic.dynamicAccesses)\n  return serverDynamic.dynamicAccesses\n}\n\nexport function formatDynamicAPIAccesses(\n  dynamicAccesses: Array<DynamicAccess>\n): string[] {\n  return dynamicAccesses\n    .filter(\n      (access): access is Required<DynamicAccess> =>\n        typeof access.stack === 'string' && access.stack.length > 0\n    )\n    .map(({ expression, stack }) => {\n      stack = stack\n        .split('\\n')\n        // Remove the \"Error: \" prefix from the first line of the stack trace as\n        // well as the first 4 lines of the stack trace which is the distance\n        // from the user code and the `new Error().stack` call.\n        .slice(4)\n        .filter((line) => {\n          // Exclude Next.js internals from the stack trace.\n          if (line.includes('node_modules/next/')) {\n            return false\n          }\n\n          // Exclude anonymous functions from the stack trace.\n          if (line.includes(' (<anonymous>)')) {\n            return false\n          }\n\n          // Exclude Node.js internals from the stack trace.\n          if (line.includes(' (node:')) {\n            return false\n          }\n\n          return true\n        })\n        .join('\\n')\n      return `Dynamic API Usage Debug - ${expression}:\\n${stack}`\n    })\n}\n\nfunction assertPostpone() {\n  if (!hasPostpone) {\n    throw new Error(\n      `Invariant: React.unstable_postpone is not defined. This suggests the wrong version of React was loaded. This is a bug in Next.js`\n    )\n  }\n}\n\n/**\n * This is a bit of a hack to allow us to abort a render using a Postpone instance instead of an Error which changes React's\n * abort semantics slightly.\n */\nexport function createRenderInBrowserAbortSignal(): AbortSignal {\n  const controller = new AbortController()\n  controller.abort(new BailoutToCSRError('Render in Browser'))\n  return controller.signal\n}\n\n/**\n * In a prerender, we may end up with hanging Promises as inputs due them\n * stalling on connection() or because they're loading dynamic data. In that\n * case we need to abort the encoding of arguments since they'll never complete.\n */\nexport function createHangingInputAbortSignal(\n  workUnitStore: WorkUnitStore\n): AbortSignal | undefined {\n  switch (workUnitStore.type) {\n    case 'prerender':\n    case 'prerender-runtime':\n      const controller = new AbortController()\n\n      if (workUnitStore.cacheSignal) {\n        // If we have a cacheSignal it means we're in a prospective render. If\n        // the input we're waiting on is coming from another cache, we do want\n        // to wait for it so that we can resolve this cache entry too.\n        workUnitStore.cacheSignal.inputReady().then(() => {\n          controller.abort()\n        })\n      } else {\n        // Otherwise we're in the final render and we should already have all\n        // our caches filled.\n        // If the prerender uses stages, we have wait until the runtime stage,\n        // at which point all runtime inputs will be resolved.\n        // (otherwise, a runtime prerender might consider `cookies()` hanging\n        //  even though they'd resolve in the next task.)\n        //\n        // We might still be waiting on some microtasks so we\n        // wait one tick before giving up. When we give up, we still want to\n        // render the content of this cache as deeply as we can so that we can\n        // suspend as deeply as possible in the tree or not at all if we don't\n        // end up waiting for the input.\n        const runtimeStagePromise = getRuntimeStagePromise(workUnitStore)\n        if (runtimeStagePromise) {\n          runtimeStagePromise.then(() =>\n            scheduleOnNextTick(() => controller.abort())\n          )\n        } else {\n          scheduleOnNextTick(() => controller.abort())\n        }\n      }\n\n      return controller.signal\n    case 'prerender-client':\n    case 'prerender-ppr':\n    case 'prerender-legacy':\n    case 'request':\n    case 'cache':\n    case 'private-cache':\n    case 'unstable-cache':\n      return undefined\n    default:\n      workUnitStore satisfies never\n  }\n}\n\nexport function annotateDynamicAccess(\n  expression: string,\n  prerenderStore: PrerenderStoreModern\n) {\n  const dynamicTracking = prerenderStore.dynamicTracking\n  if (dynamicTracking) {\n    dynamicTracking.dynamicAccesses.push({\n      stack: dynamicTracking.isDebugDynamicAccesses\n        ? new Error().stack\n        : undefined,\n      expression,\n    })\n  }\n}\n\nexport function useDynamicRouteParams(expression: string) {\n  const workStore = workAsyncStorage.getStore()\n  const workUnitStore = workUnitAsyncStorage.getStore()\n  if (workStore && workUnitStore) {\n    switch (workUnitStore.type) {\n      case 'prerender-client':\n      case 'prerender': {\n        const fallbackParams = workUnitStore.fallbackRouteParams\n\n        if (fallbackParams && fallbackParams.size > 0) {\n          // We are in a prerender with cacheComponents semantics. We are going to\n          // hang here and never resolve. This will cause the currently\n          // rendering component to effectively be a dynamic hole.\n          React.use(\n            makeHangingPromise(\n              workUnitStore.renderSignal,\n              workStore.route,\n              expression\n            )\n          )\n        }\n        break\n      }\n      case 'prerender-ppr': {\n        const fallbackParams = workUnitStore.fallbackRouteParams\n        if (fallbackParams && fallbackParams.size > 0) {\n          return postponeWithTracking(\n            workStore.route,\n            expression,\n            workUnitStore.dynamicTracking\n          )\n        }\n        break\n      }\n      case 'prerender-runtime':\n        throw new InvariantError(\n          `\\`${expression}\\` was called during a runtime prerender. Next.js should be preventing ${expression} from being included in server components statically, but did not in this case.`\n        )\n      case 'cache':\n      case 'private-cache':\n        throw new InvariantError(\n          `\\`${expression}\\` was called inside a cache scope. Next.js should be preventing ${expression} from being included in server components statically, but did not in this case.`\n        )\n      case 'prerender-legacy':\n      case 'request':\n      case 'unstable-cache':\n        break\n      default:\n        workUnitStore satisfies never\n    }\n  }\n}\n\nexport function useDynamicSearchParams(expression: string) {\n  const workStore = workAsyncStorage.getStore()\n  const workUnitStore = workUnitAsyncStorage.getStore()\n\n  if (!workStore) {\n    // We assume pages router context and just return\n    return\n  }\n\n  if (!workUnitStore) {\n    throwForMissingRequestStore(expression)\n  }\n\n  switch (workUnitStore.type) {\n    case 'prerender-client': {\n      React.use(\n        makeHangingPromise(\n          workUnitStore.renderSignal,\n          workStore.route,\n          expression\n        )\n      )\n      break\n    }\n    case 'prerender-legacy':\n    case 'prerender-ppr': {\n      if (workStore.forceStatic) {\n        return\n      }\n      throw new BailoutToCSRError(expression)\n    }\n    case 'prerender':\n    case 'prerender-runtime':\n      throw new InvariantError(\n        `\\`${expression}\\` was called from a Server Component. Next.js should be preventing ${expression} from being included in server components statically, but did not in this case.`\n      )\n    case 'cache':\n    case 'unstable-cache':\n    case 'private-cache':\n      throw new InvariantError(\n        `\\`${expression}\\` was called inside a cache scope. Next.js should be preventing ${expression} from being included in server components statically, but did not in this case.`\n      )\n    case 'request':\n      return\n    default:\n      workUnitStore satisfies never\n  }\n}\n\nconst hasSuspenseRegex = /\\n\\s+at Suspense \\(<anonymous>\\)/\n\n// Common implicit body tags that React will treat as body when placed directly in html\nconst bodyAndImplicitTags =\n  'body|div|main|section|article|aside|header|footer|nav|form|p|span|h1|h2|h3|h4|h5|h6'\n\n// Detects when RootLayoutBoundary (our framework marker component) appears\n// after Suspense in the component stack, indicating the root layout is wrapped\n// within a Suspense boundary. Ensures no body/html/implicit-body components are in between.\n//\n// Example matches:\n//   at Suspense (<anonymous>)\n//   at __next_root_layout_boundary__ (<anonymous>)\n//\n// Or with other components in between (but not body/html/implicit-body):\n//   at Suspense (<anonymous>)\n//   at SomeComponent (<anonymous>)\n//   at __next_root_layout_boundary__ (<anonymous>)\nconst hasSuspenseBeforeRootLayoutWithoutBodyOrImplicitBodyRegex = new RegExp(\n  `\\\\n\\\\s+at Suspense \\\\(<anonymous>\\\\)(?:(?!\\\\n\\\\s+at (?:${bodyAndImplicitTags}) \\\\(<anonymous>\\\\))[\\\\s\\\\S])*?\\\\n\\\\s+at ${ROOT_LAYOUT_BOUNDARY_NAME} \\\\([^\\\\n]*\\\\)`\n)\n\nconst hasMetadataRegex = new RegExp(\n  `\\\\n\\\\s+at ${METADATA_BOUNDARY_NAME}[\\\\n\\\\s]`\n)\nconst hasViewportRegex = new RegExp(\n  `\\\\n\\\\s+at ${VIEWPORT_BOUNDARY_NAME}[\\\\n\\\\s]`\n)\nconst hasOutletRegex = new RegExp(`\\\\n\\\\s+at ${OUTLET_BOUNDARY_NAME}[\\\\n\\\\s]`)\n\nexport function trackAllowedDynamicAccess(\n  workStore: WorkStore,\n  componentStack: string,\n  dynamicValidation: DynamicValidationState,\n  clientDynamic: DynamicTrackingState\n) {\n  if (hasOutletRegex.test(componentStack)) {\n    // We don't need to track that this is dynamic. It is only so when something else is also dynamic.\n    return\n  } else if (hasMetadataRegex.test(componentStack)) {\n    dynamicValidation.hasDynamicMetadata = true\n    return\n  } else if (hasViewportRegex.test(componentStack)) {\n    dynamicValidation.hasDynamicViewport = true\n    return\n  } else if (\n    hasSuspenseBeforeRootLayoutWithoutBodyOrImplicitBodyRegex.test(\n      componentStack\n    )\n  ) {\n    // For Suspense within body, the prelude wouldn't be empty so it wouldn't violate the empty static shells rule.\n    // But if you have Suspense above body, the prelude is empty but we allow that because having Suspense\n    // is an explicit signal from the user that they acknowledge the empty shell and want dynamic rendering.\n    dynamicValidation.hasAllowedDynamic = true\n    dynamicValidation.hasSuspenseAboveBody = true\n    return\n  } else if (hasSuspenseRegex.test(componentStack)) {\n    // this error had a Suspense boundary above it so we don't need to report it as a source\n    // of disallowed\n    dynamicValidation.hasAllowedDynamic = true\n    return\n  } else if (clientDynamic.syncDynamicErrorWithStack) {\n    // This task was the task that called the sync error.\n    dynamicValidation.dynamicErrors.push(\n      clientDynamic.syncDynamicErrorWithStack\n    )\n    return\n  } else {\n    const message =\n      `Route \"${workStore.route}\": Uncached data was accessed outside of ` +\n      '<Suspense>. This delays the entire page from rendering, resulting in a ' +\n      'slow user experience. Learn more: ' +\n      'https://nextjs.org/docs/messages/blocking-route'\n    const error = createErrorWithComponentOrOwnerStack(message, componentStack)\n    dynamicValidation.dynamicErrors.push(error)\n    return\n  }\n}\n\nexport function trackDynamicHoleInRuntimeShell(\n  workStore: WorkStore,\n  componentStack: string,\n  dynamicValidation: DynamicValidationState,\n  clientDynamic: DynamicTrackingState\n) {\n  if (hasOutletRegex.test(componentStack)) {\n    // We don't need to track that this is dynamic. It is only so when something else is also dynamic.\n    return\n  } else if (hasMetadataRegex.test(componentStack)) {\n    const message = `Route \"${workStore.route}\": Uncached data or \\`connection()\\` was accessed inside \\`generateMetadata\\`. Except for this instance, the page would have been entirely prerenderable which may have been the intended behavior. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-metadata`\n    const error = createErrorWithComponentOrOwnerStack(message, componentStack)\n    dynamicValidation.dynamicMetadata = error\n    return\n  } else if (hasViewportRegex.test(componentStack)) {\n    const message = `Route \"${workStore.route}\": Uncached data or \\`connection()\\` was accessed inside \\`generateViewport\\`. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/next-prerender-dynamic-viewport`\n    const error = createErrorWithComponentOrOwnerStack(message, componentStack)\n    dynamicValidation.dynamicErrors.push(error)\n    return\n  } else if (\n    hasSuspenseBeforeRootLayoutWithoutBodyOrImplicitBodyRegex.test(\n      componentStack\n    )\n  ) {\n    // For Suspense within body, the prelude wouldn't be empty so it wouldn't violate the empty static shells rule.\n    // But if you have Suspense above body, the prelude is empty but we allow that because having Suspense\n    // is an explicit signal from the user that they acknowledge the empty shell and want dynamic rendering.\n    dynamicValidation.hasAllowedDynamic = true\n    dynamicValidation.hasSuspenseAboveBody = true\n    return\n  } else if (hasSuspenseRegex.test(componentStack)) {\n    // this error had a Suspense boundary above it so we don't need to report it as a source\n    // of disallowed\n    dynamicValidation.hasAllowedDynamic = true\n    return\n  } else if (clientDynamic.syncDynamicErrorWithStack) {\n    // This task was the task that called the sync error.\n    dynamicValidation.dynamicErrors.push(\n      clientDynamic.syncDynamicErrorWithStack\n    )\n    return\n  } else {\n    const message = `Route \"${workStore.route}\": Uncached data or \\`connection()\\` was accessed outside of \\`<Suspense>\\`. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route`\n    const error = createErrorWithComponentOrOwnerStack(message, componentStack)\n    dynamicValidation.dynamicErrors.push(error)\n    return\n  }\n}\n\nexport function trackDynamicHoleInStaticShell(\n  workStore: WorkStore,\n  componentStack: string,\n  dynamicValidation: DynamicValidationState,\n  clientDynamic: DynamicTrackingState\n) {\n  if (hasOutletRegex.test(componentStack)) {\n    // We don't need to track that this is dynamic. It is only so when something else is also dynamic.\n    return\n  } else if (hasMetadataRegex.test(componentStack)) {\n    const message = `Route \"${workStore.route}\": Runtime data such as \\`cookies()\\`, \\`headers()\\`, \\`params\\`, or \\`searchParams\\` was accessed inside \\`generateMetadata\\` or you have file-based metadata such as icons that depend on dynamic params segments. Except for this instance, the page would have been entirely prerenderable which may have been the intended behavior. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-metadata`\n    const error = createErrorWithComponentOrOwnerStack(message, componentStack)\n    dynamicValidation.dynamicMetadata = error\n    return\n  } else if (hasViewportRegex.test(componentStack)) {\n    const message = `Route \"${workStore.route}\": Runtime data such as \\`cookies()\\`, \\`headers()\\`, \\`params\\`, or \\`searchParams\\` was accessed inside \\`generateViewport\\`. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/next-prerender-dynamic-viewport`\n    const error = createErrorWithComponentOrOwnerStack(message, componentStack)\n    dynamicValidation.dynamicErrors.push(error)\n    return\n  } else if (\n    hasSuspenseBeforeRootLayoutWithoutBodyOrImplicitBodyRegex.test(\n      componentStack\n    )\n  ) {\n    // For Suspense within body, the prelude wouldn't be empty so it wouldn't violate the empty static shells rule.\n    // But if you have Suspense above body, the prelude is empty but we allow that because having Suspense\n    // is an explicit signal from the user that they acknowledge the empty shell and want dynamic rendering.\n    dynamicValidation.hasAllowedDynamic = true\n    dynamicValidation.hasSuspenseAboveBody = true\n    return\n  } else if (hasSuspenseRegex.test(componentStack)) {\n    // this error had a Suspense boundary above it so we don't need to report it as a source\n    // of disallowed\n    dynamicValidation.hasAllowedDynamic = true\n    return\n  } else if (clientDynamic.syncDynamicErrorWithStack) {\n    // This task was the task that called the sync error.\n    dynamicValidation.dynamicErrors.push(\n      clientDynamic.syncDynamicErrorWithStack\n    )\n    return\n  } else {\n    const message = `Route \"${workStore.route}\": Runtime data such as \\`cookies()\\`, \\`headers()\\`, \\`params\\`, or \\`searchParams\\` was accessed outside of \\`<Suspense>\\`. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route`\n    const error = createErrorWithComponentOrOwnerStack(message, componentStack)\n    dynamicValidation.dynamicErrors.push(error)\n    return\n  }\n}\n\n/**\n * In dev mode, we prefer using the owner stack, otherwise the provided\n * component stack is used.\n */\nfunction createErrorWithComponentOrOwnerStack(\n  message: string,\n  componentStack: string\n) {\n  const ownerStack =\n    process.env.NODE_ENV !== 'production' && React.captureOwnerStack\n      ? React.captureOwnerStack()\n      : null\n\n  const error = new Error(message)\n  // TODO go back to owner stack here if available. This is temporarily using componentStack to get the right\n  //\n  error.stack = error.name + ': ' + message + (ownerStack || componentStack)\n  return error\n}\n\nexport enum PreludeState {\n  Full = 0,\n  Empty = 1,\n  Errored = 2,\n}\n\nexport function logDisallowedDynamicError(\n  workStore: WorkStore,\n  error: Error\n): void {\n  console.error(error)\n\n  if (!workStore.dev) {\n    if (workStore.hasReadableErrorStacks) {\n      console.error(\n        `To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"${workStore.route}\" in your browser to investigate the error.`\n      )\n    } else {\n      console.error(`To get a more detailed stack trace and pinpoint the issue, try one of the following:\n  - Start the app in development mode by running \\`next dev\\`, then open \"${workStore.route}\" in your browser to investigate the error.\n  - Rerun the production build with \\`next build --debug-prerender\\` to generate better stack traces.`)\n    }\n  }\n}\n\nexport function throwIfDisallowedDynamic(\n  workStore: WorkStore,\n  prelude: PreludeState,\n  dynamicValidation: DynamicValidationState,\n  serverDynamic: DynamicTrackingState\n): void {\n  if (serverDynamic.syncDynamicErrorWithStack) {\n    logDisallowedDynamicError(\n      workStore,\n      serverDynamic.syncDynamicErrorWithStack\n    )\n    throw new StaticGenBailoutError()\n  }\n\n  if (prelude !== PreludeState.Full) {\n    if (dynamicValidation.hasSuspenseAboveBody) {\n      // This route has opted into allowing fully dynamic rendering\n      // by including a Suspense boundary above the body. In this case\n      // a lack of a shell is not considered disallowed so we simply return\n      return\n    }\n\n    // We didn't have any sync bailouts but there may be user code which\n    // blocked the root. We would have captured these during the prerender\n    // and can log them here and then terminate the build/validating render\n    const dynamicErrors = dynamicValidation.dynamicErrors\n    if (dynamicErrors.length > 0) {\n      for (let i = 0; i < dynamicErrors.length; i++) {\n        logDisallowedDynamicError(workStore, dynamicErrors[i])\n      }\n\n      throw new StaticGenBailoutError()\n    }\n\n    // If we got this far then the only other thing that could be blocking\n    // the root is dynamic Viewport. If this is dynamic then\n    // you need to opt into that by adding a Suspense boundary above the body\n    // to indicate your are ok with fully dynamic rendering.\n    if (dynamicValidation.hasDynamicViewport) {\n      console.error(\n        `Route \"${workStore.route}\" has a \\`generateViewport\\` that depends on Request data (\\`cookies()\\`, etc...) or uncached external data (\\`fetch(...)\\`, etc...) without explicitly allowing fully dynamic rendering. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-viewport`\n      )\n      throw new StaticGenBailoutError()\n    }\n\n    if (prelude === PreludeState.Empty) {\n      // If we ever get this far then we messed up the tracking of invalid dynamic.\n      // We still adhere to the constraint that you must produce a shell but invite the\n      // user to report this as a bug in Next.js.\n      console.error(\n        `Route \"${workStore.route}\" did not produce a static shell and Next.js was unable to determine a reason. This is a bug in Next.js.`\n      )\n      throw new StaticGenBailoutError()\n    }\n  } else {\n    if (\n      dynamicValidation.hasAllowedDynamic === false &&\n      dynamicValidation.hasDynamicMetadata\n    ) {\n      console.error(\n        `Route \"${workStore.route}\" has a \\`generateMetadata\\` that depends on Request data (\\`cookies()\\`, etc...) or uncached external data (\\`fetch(...)\\`, etc...) when the rest of the route does not. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-metadata`\n      )\n      throw new StaticGenBailoutError()\n    }\n  }\n}\n\nexport function getStaticShellDisallowedDynamicReasons(\n  workStore: WorkStore,\n  prelude: PreludeState,\n  dynamicValidation: DynamicValidationState\n): Array<Error> {\n  if (dynamicValidation.hasSuspenseAboveBody) {\n    // This route has opted into allowing fully dynamic rendering\n    // by including a Suspense boundary above the body. In this case\n    // a lack of a shell is not considered disallowed so we simply return\n    return []\n  }\n\n  if (prelude !== PreludeState.Full) {\n    // We didn't have any sync bailouts but there may be user code which\n    // blocked the root. We would have captured these during the prerender\n    // and can log them here and then terminate the build/validating render\n    const dynamicErrors = dynamicValidation.dynamicErrors\n    if (dynamicErrors.length > 0) {\n      return dynamicErrors\n    }\n\n    if (prelude === PreludeState.Empty) {\n      // If we ever get this far then we messed up the tracking of invalid dynamic.\n      // We still adhere to the constraint that you must produce a shell but invite the\n      // user to report this as a bug in Next.js.\n      return [\n        new InvariantError(\n          `Route \"${workStore.route}\" did not produce a static shell and Next.js was unable to determine a reason.`\n        ),\n      ]\n    }\n  } else {\n    // We have a prelude but we might still have dynamic metadata without any other dynamic access\n    if (\n      dynamicValidation.hasAllowedDynamic === false &&\n      dynamicValidation.dynamicErrors.length === 0 &&\n      dynamicValidation.dynamicMetadata\n    ) {\n      return [dynamicValidation.dynamicMetadata]\n    }\n  }\n  // We had a non-empty prelude and there are no dynamic holes\n  return []\n}\n\nexport function delayUntilRuntimeStage<T>(\n  prerenderStore: PrerenderStoreModernRuntime,\n  result: Promise<T>\n): Promise<T> {\n  if (prerenderStore.runtimeStagePromise) {\n    return prerenderStore.runtimeStagePromise.then(() => result)\n  }\n  return result\n}\n","import type { IncomingMessage } from 'http'\nimport type { ParsedUrlQuery } from 'querystring'\nimport type { UrlWithParsedQuery } from 'url'\nimport type { BaseNextRequest } from './base-http'\nimport type { CloneableBody } from './body-streams'\nimport type { RouteMatch } from './route-matches/route-match'\nimport type { NEXT_RSC_UNION_QUERY } from '../client/components/app-router-headers'\nimport type {\n  ResponseCacheEntry,\n  ServerComponentsHmrCache,\n} from './response-cache'\nimport type { PagesDevOverlayBridgeType } from '../next-devtools/userspace/pages/pages-dev-overlay-setup'\nimport type { OpaqueFallbackRouteParams } from './request/fallback-params'\nimport type { IncrementalCache } from './lib/incremental-cache'\n\n// FIXME: (wyattjoh) this is a temporary solution to allow us to pass data between bundled modules\nexport const NEXT_REQUEST_META = Symbol.for('NextInternalRequestMeta')\n\nexport type NextIncomingMessage = (BaseNextRequest | IncomingMessage) & {\n  [NEXT_REQUEST_META]?: RequestMeta\n}\n\n/**\n * The callback function to call when a response cache entry was generated or\n * looked up in the cache. When it returns true, the server assumes that the\n * handler has already responded to the request and will not do so itself.\n */\nexport type OnCacheEntryHandler = (\n  /**\n   * The response cache entry that was generated or looked up in the cache.\n   */\n  cacheEntry: ResponseCacheEntry,\n\n  /**\n   * The request metadata.\n   */\n  requestMeta: {\n    /**\n     * The URL that was used to make the request.\n     */\n    url: string | undefined\n  }\n) => Promise<boolean | void> | boolean | void\n\nexport interface RequestMeta {\n  /**\n   * The query that was used to make the request.\n   */\n  initQuery?: ParsedUrlQuery\n\n  /**\n   * The URL that was used to make the request.\n   */\n  initURL?: string\n\n  /**\n   * The protocol that was used to make the request.\n   */\n  initProtocol?: string\n\n  /**\n   * The body that was read from the request. This is used to allow the body to\n   * be read multiple times.\n   */\n  clonableBody?: CloneableBody\n\n  /**\n   * True when the request matched a locale domain that was configured in the\n   * next.config.js file.\n   */\n  isLocaleDomain?: boolean\n\n  /**\n   * True when the request had locale information stripped from the pathname\n   * part of the URL.\n   */\n  didStripLocale?: boolean\n\n  /**\n   * If the request had it's URL rewritten, this is the URL it was rewritten to.\n   */\n  rewroteURL?: string\n\n  /**\n   * The cookies that were added by middleware and were added to the response.\n   */\n  middlewareCookie?: string[]\n\n  /**\n   * The match on the request for a given route.\n   */\n  match?: RouteMatch\n\n  /**\n   * The incremental cache to use for the request.\n   */\n  incrementalCache?: IncrementalCache\n\n  /**\n   * The server components HMR cache, only for dev.\n   */\n  serverComponentsHmrCache?: ServerComponentsHmrCache\n\n  /**\n   * Equals the segment path that was used for the prefetch RSC request.\n   */\n  segmentPrefetchRSCRequest?: string\n\n  /**\n   * True when the request is for the prefetch flight data.\n   */\n  isPrefetchRSCRequest?: true\n\n  /**\n   * True when the request is for the flight data.\n   */\n  isRSCRequest?: true\n\n  /**\n   * A search param set by the Next.js client when performing RSC requests.\n   * Because some CDNs do not vary their cache entries on our custom headers,\n   * this search param represents a hash of the header values. For any cached\n   * RSC request, we should verify that the hash matches before responding.\n   * Otherwise this can lead to cache poisoning.\n   * TODO: Consider not using custom request headers at all, and instead encode\n   * everything into the search param.\n   */\n  cacheBustingSearchParam?: string\n\n  /**\n   * True when the request is for the `/_next/data` route using the pages\n   * router.\n   */\n  isNextDataReq?: true\n\n  /**\n   * Postponed state to use for resumption. If present it's assumed that the\n   * request is for a page that has postponed (there are no guarantees that the\n   * page actually has postponed though as it would incur an additional cache\n   * lookup).\n   */\n  postponed?: string\n\n  /**\n   * If provided, this will be called when a response cache entry was generated\n   * or looked up in the cache.\n   *\n   * @deprecated Use `onCacheEntryV2` instead.\n   */\n  onCacheEntry?: OnCacheEntryHandler\n\n  /**\n   * If provided, this will be called when a response cache entry was generated\n   * or looked up in the cache.\n   */\n  onCacheEntryV2?: OnCacheEntryHandler\n\n  /**\n   * The previous revalidate before rendering 404 page for notFound: true\n   */\n  notFoundRevalidate?: number | false\n\n  /**\n   * In development, the original source page that returned a 404.\n   */\n  developmentNotFoundSourcePage?: string\n\n  /**\n   * The path we routed to and should be invoked\n   */\n  invokePath?: string\n\n  /**\n   * The specific page output we should be matching\n   */\n  invokeOutput?: string\n\n  /**\n   * The status we are invoking the request with from routing\n   */\n  invokeStatus?: number\n\n  /**\n   * The routing error we are invoking with\n   */\n  invokeError?: Error\n\n  /**\n   * The query parsed for the invocation\n   */\n  invokeQuery?: Record<string, undefined | string | string[]>\n\n  /**\n   * Whether the request is a middleware invocation\n   */\n  middlewareInvoke?: boolean\n\n  /**\n   * Whether the request should render the fallback shell or not.\n   */\n  renderFallbackShell?: boolean\n\n  /**\n   * Whether the request is for the custom error page.\n   */\n  customErrorRender?: true\n\n  /**\n   * Whether to bubble up the NoFallbackError to the caller when a 404 is\n   * returned.\n   */\n  bubbleNoFallback?: true\n\n  /**\n   * True when the request had locale information inferred from the default\n   * locale.\n   */\n  localeInferredFromDefault?: true\n\n  /**\n   * The locale that was inferred or explicitly set for the request.\n   */\n  locale?: string\n\n  /**\n   * The default locale that was inferred or explicitly set for the request.\n   */\n  defaultLocale?: string\n\n  /**\n   * The relative project dir the server is running in from project root\n   */\n  relativeProjectDir?: string\n\n  /**\n   * The dist directory the server is currently using\n   */\n  distDir?: string\n\n  /**\n   * The query after resolving routes\n   */\n  query?: ParsedUrlQuery\n\n  /**\n   * The params after resolving routes\n   */\n  params?: ParsedUrlQuery\n\n  /**\n   * ErrorOverlay component to use in development for pages router\n   */\n  PagesErrorDebug?: PagesDevOverlayBridgeType\n\n  /**\n   * Whether server is in minimal mode (this will be replaced with more\n   * specific flags in future)\n   */\n  minimalMode?: boolean\n\n  /**\n   * DEV only: The fallback params that should be used when validating prerenders during dev\n   */\n  devFallbackParams?: OpaqueFallbackRouteParams\n\n  /**\n   * DEV only: Request timings in process.hrtime.bigint()\n   */\n  devRequestTimingStart?: bigint\n  devRequestTimingMiddlewareStart?: bigint\n  devRequestTimingMiddlewareEnd?: bigint\n  devRequestTimingInternalsEnd?: bigint\n\n  /**\n   * DEV only: The duration of getStaticPaths/generateStaticParams in process.hrtime.bigint()\n   */\n  devGenerateStaticParamsDuration?: bigint\n}\n\n/**\n * Gets the request metadata. If no key is provided, the entire metadata object\n * is returned.\n *\n * @param req the request to get the metadata from\n * @param key the key to get from the metadata (optional)\n * @returns the value for the key or the entire metadata object\n */\nexport function getRequestMeta(\n  req: NextIncomingMessage,\n  key?: undefined\n): RequestMeta\nexport function getRequestMeta<K extends keyof RequestMeta>(\n  req: NextIncomingMessage,\n  key: K\n): RequestMeta[K]\nexport function getRequestMeta<K extends keyof RequestMeta>(\n  req: NextIncomingMessage,\n  key?: K\n): RequestMeta | RequestMeta[K] {\n  const meta = req[NEXT_REQUEST_META] || {}\n  return typeof key === 'string' ? meta[key] : meta\n}\n\n/**\n * Sets the request metadata.\n *\n * @param req the request to set the metadata on\n * @param meta the metadata to set\n * @returns the mutated request metadata\n */\nexport function setRequestMeta(req: NextIncomingMessage, meta: RequestMeta) {\n  req[NEXT_REQUEST_META] = meta\n  return meta\n}\n\n/**\n * Adds a value to the request metadata.\n *\n * @param request the request to mutate\n * @param key the key to set\n * @param value the value to set\n * @returns the mutated request metadata\n */\nexport function addRequestMeta<K extends keyof RequestMeta>(\n  request: NextIncomingMessage,\n  key: K,\n  value: RequestMeta[K]\n) {\n  const meta = getRequestMeta(request)\n  meta[key] = value\n  return setRequestMeta(request, meta)\n}\n\n/**\n * Removes a key from the request metadata.\n *\n * @param request the request to mutate\n * @param key the key to remove\n * @returns the mutated request metadata\n */\nexport function removeRequestMeta<K extends keyof RequestMeta>(\n  request: NextIncomingMessage,\n  key: K\n) {\n  const meta = getRequestMeta(request)\n  delete meta[key]\n  return setRequestMeta(request, meta)\n}\n\ntype NextQueryMetadata = {\n  /**\n   * The `_rsc` query parameter used for cache busting to ensure that the RSC\n   * requests do not get cached by the browser explicitly.\n   */\n  [NEXT_RSC_UNION_QUERY]?: string\n}\n\nexport type NextParsedUrlQuery = ParsedUrlQuery & NextQueryMetadata\n\nexport interface NextUrlWithParsedQuery extends UrlWithParsedQuery {\n  query: NextParsedUrlQuery\n}\n","import type { DomainLocale } from '../../../server/config-shared'\n\nexport function detectDomainLocale(\n  domainItems?: readonly DomainLocale[],\n  hostname?: string,\n  detectedLocale?: string\n) {\n  if (!domainItems) return\n\n  if (detectedLocale) {\n    detectedLocale = detectedLocale.toLowerCase()\n  }\n\n  for (const item of domainItems) {\n    // remove port if present\n    const domainHostname = item.domain?.split(':', 1)[0].toLowerCase()\n    if (\n      hostname === domainHostname ||\n      detectedLocale === item.defaultLocale.toLowerCase() ||\n      item.locales?.some((locale) => locale.toLowerCase() === detectedLocale)\n    ) {\n      return item\n    }\n  }\n}\n","import { parsePath } from './parse-path'\n\n/**\n * Adds the provided prefix to the given path. It first ensures that the path\n * is indeed starting with a slash.\n */\nexport function addPathPrefix(path: string, prefix?: string) {\n  if (!path.startsWith('/') || !prefix) {\n    return path\n  }\n\n  const { pathname, query, hash } = parsePath(path)\n  return `${prefix}${pathname}${query}${hash}`\n}\n","import { parsePath } from './parse-path'\n\n/**\n * Similarly to `addPathPrefix`, this function adds a suffix at the end on the\n * provided path. It also works only for paths ensuring the argument starts\n * with a slash.\n */\nexport function addPathSuffix(path: string, suffix?: string) {\n  if (!path.startsWith('/') || !suffix) {\n    return path\n  }\n\n  const { pathname, query, hash } = parsePath(path)\n  return `${pathname}${suffix}${query}${hash}`\n}\n","import { addPathPrefix } from './add-path-prefix'\nimport { pathHasPrefix } from './path-has-prefix'\n\n/**\n * For a given path and a locale, if the locale is given, it will prefix the\n * locale. The path shouldn't be an API path. If a default locale is given the\n * prefix will be omitted if the locale is already the default locale.\n */\nexport function addLocale(\n  path: string,\n  locale?: string | false,\n  defaultLocale?: string,\n  ignorePrefix?: boolean\n) {\n  // If no locale was given or the locale is the default locale, we don't need\n  // to prefix the path.\n  if (!locale || locale === defaultLocale) return path\n\n  const lower = path.toLowerCase()\n\n  // If the path is an API path or the path already has the locale prefix, we\n  // don't need to prefix the path.\n  if (!ignorePrefix) {\n    if (pathHasPrefix(lower, '/api')) return path\n    if (pathHasPrefix(lower, `/${locale.toLowerCase()}`)) return path\n  }\n\n  // Add the locale prefix to the path.\n  return addPathPrefix(path, `/${locale}`)\n}\n","import type { NextPathnameInfo } from './get-next-pathname-info'\nimport { removeTrailingSlash } from './remove-trailing-slash'\nimport { addPathPrefix } from './add-path-prefix'\nimport { addPathSuffix } from './add-path-suffix'\nimport { addLocale } from './add-locale'\n\ninterface ExtendedInfo extends NextPathnameInfo {\n  defaultLocale?: string\n  ignorePrefix?: boolean\n}\n\nexport function formatNextPathnameInfo(info: ExtendedInfo) {\n  let pathname = addLocale(\n    info.pathname,\n    info.locale,\n    info.buildId ? undefined : info.defaultLocale,\n    info.ignorePrefix\n  )\n\n  if (info.buildId || !info.trailingSlash) {\n    pathname = removeTrailingSlash(pathname)\n  }\n\n  if (info.buildId) {\n    pathname = addPathSuffix(\n      addPathPrefix(pathname, `/_next/data/${info.buildId}`),\n      info.pathname === '/' ? 'index.json' : '.json'\n    )\n  }\n\n  pathname = addPathPrefix(pathname, info.basePath)\n  return !info.buildId && info.trailingSlash\n    ? !pathname.endsWith('/')\n      ? addPathSuffix(pathname, '/')\n      : pathname\n    : removeTrailingSlash(pathname)\n}\n","import type { OutgoingHttpHeaders } from 'http'\n\n/**\n * Takes an object with a hostname property (like a parsed URL) and some\n * headers that may contain Host and returns the preferred hostname.\n * @param parsed An object containing a hostname property.\n * @param headers A dictionary with headers containing a `host`.\n */\nexport function getHostname(\n  parsed: { hostname?: string | null },\n  headers?: OutgoingHttpHeaders\n): string | undefined {\n  // Get the hostname from the headers if it exists, otherwise use the parsed\n  // hostname.\n  let hostname: string\n  if (headers?.host && !Array.isArray(headers.host)) {\n    hostname = headers.host.toString().split(':', 1)[0]\n  } else if (parsed.hostname) {\n    hostname = parsed.hostname\n  } else return\n\n  return hostname.toLowerCase()\n}\n","import { normalizeLocalePath } from '../../i18n/normalize-locale-path'\nimport { removePathPrefix } from './remove-path-prefix'\nimport { pathHasPrefix } from './path-has-prefix'\nimport type { I18NProvider } from '../../../../server/lib/i18n-provider'\n\nexport interface NextPathnameInfo {\n  /**\n   * The base path in case the pathname included it.\n   */\n  basePath?: string\n  /**\n   * The buildId for when the parsed URL is a data URL. Parsing it can be\n   * disabled with the `parseData` option.\n   */\n  buildId?: string\n  /**\n   * If there was a locale in the pathname, this will hold its value.\n   */\n  locale?: string\n  /**\n   * The processed pathname without a base path, locale, or data URL elements\n   * when parsing it is enabled.\n   */\n  pathname: string\n  /**\n   * A boolean telling if the pathname had a trailingSlash. This can be only\n   * true if trailingSlash is enabled.\n   */\n  trailingSlash?: boolean\n}\n\ninterface Options {\n  /**\n   * When passed to true, this function will also parse Nextjs data URLs.\n   */\n  parseData?: boolean\n  /**\n   * A partial of the Next.js configuration to parse the URL.\n   */\n  nextConfig?: {\n    basePath?: string\n    i18n?: { locales?: readonly string[] } | null\n    trailingSlash?: boolean\n  }\n\n  /**\n   * If provided, this normalizer will be used to detect the locale instead of\n   * the default locale detection.\n   */\n  i18nProvider?: I18NProvider\n}\n\nexport function getNextPathnameInfo(\n  pathname: string,\n  options: Options\n): NextPathnameInfo {\n  const { basePath, i18n, trailingSlash } = options.nextConfig ?? {}\n  const info: NextPathnameInfo = {\n    pathname,\n    trailingSlash: pathname !== '/' ? pathname.endsWith('/') : trailingSlash,\n  }\n\n  if (basePath && pathHasPrefix(info.pathname, basePath)) {\n    info.pathname = removePathPrefix(info.pathname, basePath)\n    info.basePath = basePath\n  }\n  let pathnameNoDataPrefix = info.pathname\n\n  if (\n    info.pathname.startsWith('/_next/data/') &&\n    info.pathname.endsWith('.json')\n  ) {\n    const paths = info.pathname\n      .replace(/^\\/_next\\/data\\//, '')\n      .replace(/\\.json$/, '')\n      .split('/')\n\n    const buildId = paths[0]\n    info.buildId = buildId\n    pathnameNoDataPrefix =\n      paths[1] !== 'index' ? `/${paths.slice(1).join('/')}` : '/'\n\n    // update pathname with normalized if enabled although\n    // we use normalized to populate locale info still\n    if (options.parseData === true) {\n      info.pathname = pathnameNoDataPrefix\n    }\n  }\n\n  // If provided, use the locale route normalizer to detect the locale instead\n  // of the function below.\n  if (i18n) {\n    let result = options.i18nProvider\n      ? options.i18nProvider.analyze(info.pathname)\n      : normalizeLocalePath(info.pathname, i18n.locales)\n\n    info.locale = result.detectedLocale\n    info.pathname = result.pathname ?? info.pathname\n\n    if (!result.detectedLocale && info.buildId) {\n      result = options.i18nProvider\n        ? options.i18nProvider.analyze(pathnameNoDataPrefix)\n        : normalizeLocalePath(pathnameNoDataPrefix, i18n.locales)\n\n      if (result.detectedLocale) {\n        info.locale = result.detectedLocale\n      }\n    }\n  }\n  return info\n}\n","import type { OutgoingHttpHeaders } from 'http'\nimport type { DomainLocale, I18NConfig } from '../config-shared'\nimport type { I18NProvider } from '../lib/i18n-provider'\n\nimport { detectDomainLocale } from '../../shared/lib/i18n/detect-domain-locale'\nimport { formatNextPathnameInfo } from '../../shared/lib/router/utils/format-next-pathname-info'\nimport { getHostname } from '../../shared/lib/get-hostname'\nimport { getNextPathnameInfo } from '../../shared/lib/router/utils/get-next-pathname-info'\n\ninterface Options {\n  base?: string | URL\n  headers?: OutgoingHttpHeaders\n  forceLocale?: boolean\n  nextConfig?: {\n    basePath?: string\n    i18n?: I18NConfig | null\n    trailingSlash?: boolean\n  }\n  i18nProvider?: I18NProvider\n}\n\nconst REGEX_LOCALHOST_HOSTNAME =\n  /(?!^https?:\\/\\/)(127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\\[::1\\]|localhost)/\n\nfunction parseURL(url: string | URL, base?: string | URL) {\n  return new URL(\n    String(url).replace(REGEX_LOCALHOST_HOSTNAME, 'localhost'),\n    base && String(base).replace(REGEX_LOCALHOST_HOSTNAME, 'localhost')\n  )\n}\n\nconst Internal = Symbol('NextURLInternal')\n\nexport class NextURL {\n  private [Internal]: {\n    basePath: string\n    buildId?: string\n    flightSearchParameters?: Record<string, string>\n    defaultLocale?: string\n    domainLocale?: DomainLocale\n    locale?: string\n    options: Options\n    trailingSlash?: boolean\n    url: URL\n  }\n\n  constructor(input: string | URL, base?: string | URL, opts?: Options)\n  constructor(input: string | URL, opts?: Options)\n  constructor(\n    input: string | URL,\n    baseOrOpts?: string | URL | Options,\n    opts?: Options\n  ) {\n    let base: undefined | string | URL\n    let options: Options\n\n    if (\n      (typeof baseOrOpts === 'object' && 'pathname' in baseOrOpts) ||\n      typeof baseOrOpts === 'string'\n    ) {\n      base = baseOrOpts\n      options = opts || {}\n    } else {\n      options = opts || baseOrOpts || {}\n    }\n\n    this[Internal] = {\n      url: parseURL(input, base ?? options.base),\n      options: options,\n      basePath: '',\n    }\n\n    this.analyze()\n  }\n\n  private analyze() {\n    const info = getNextPathnameInfo(this[Internal].url.pathname, {\n      nextConfig: this[Internal].options.nextConfig,\n      parseData: !process.env.__NEXT_NO_MIDDLEWARE_URL_NORMALIZE,\n      i18nProvider: this[Internal].options.i18nProvider,\n    })\n\n    const hostname = getHostname(\n      this[Internal].url,\n      this[Internal].options.headers\n    )\n    this[Internal].domainLocale = this[Internal].options.i18nProvider\n      ? this[Internal].options.i18nProvider.detectDomainLocale(hostname)\n      : detectDomainLocale(\n          this[Internal].options.nextConfig?.i18n?.domains,\n          hostname\n        )\n\n    const defaultLocale =\n      this[Internal].domainLocale?.defaultLocale ||\n      this[Internal].options.nextConfig?.i18n?.defaultLocale\n\n    this[Internal].url.pathname = info.pathname\n    this[Internal].defaultLocale = defaultLocale\n    this[Internal].basePath = info.basePath ?? ''\n    this[Internal].buildId = info.buildId\n    this[Internal].locale = info.locale ?? defaultLocale\n    this[Internal].trailingSlash = info.trailingSlash\n  }\n\n  private formatPathname() {\n    return formatNextPathnameInfo({\n      basePath: this[Internal].basePath,\n      buildId: this[Internal].buildId,\n      defaultLocale: !this[Internal].options.forceLocale\n        ? this[Internal].defaultLocale\n        : undefined,\n      locale: this[Internal].locale,\n      pathname: this[Internal].url.pathname,\n      trailingSlash: this[Internal].trailingSlash,\n    })\n  }\n\n  private formatSearch() {\n    return this[Internal].url.search\n  }\n\n  public get buildId() {\n    return this[Internal].buildId\n  }\n\n  public set buildId(buildId: string | undefined) {\n    this[Internal].buildId = buildId\n  }\n\n  public get locale() {\n    return this[Internal].locale ?? ''\n  }\n\n  public set locale(locale: string) {\n    if (\n      !this[Internal].locale ||\n      !this[Internal].options.nextConfig?.i18n?.locales.includes(locale)\n    ) {\n      throw new TypeError(\n        `The NextURL configuration includes no locale \"${locale}\"`\n      )\n    }\n\n    this[Internal].locale = locale\n  }\n\n  get defaultLocale() {\n    return this[Internal].defaultLocale\n  }\n\n  get domainLocale() {\n    return this[Internal].domainLocale\n  }\n\n  get searchParams() {\n    return this[Internal].url.searchParams\n  }\n\n  get host() {\n    return this[Internal].url.host\n  }\n\n  set host(value: string) {\n    this[Internal].url.host = value\n  }\n\n  get hostname() {\n    return this[Internal].url.hostname\n  }\n\n  set hostname(value: string) {\n    this[Internal].url.hostname = value\n  }\n\n  get port() {\n    return this[Internal].url.port\n  }\n\n  set port(value: string) {\n    this[Internal].url.port = value\n  }\n\n  get protocol() {\n    return this[Internal].url.protocol\n  }\n\n  set protocol(value: string) {\n    this[Internal].url.protocol = value\n  }\n\n  get href() {\n    const pathname = this.formatPathname()\n    const search = this.formatSearch()\n    return `${this.protocol}//${this.host}${pathname}${search}${this.hash}`\n  }\n\n  set href(url: string) {\n    this[Internal].url = parseURL(url)\n    this.analyze()\n  }\n\n  get origin() {\n    return this[Internal].url.origin\n  }\n\n  get pathname() {\n    return this[Internal].url.pathname\n  }\n\n  set pathname(value: string) {\n    this[Internal].url.pathname = value\n  }\n\n  get hash() {\n    return this[Internal].url.hash\n  }\n\n  set hash(value: string) {\n    this[Internal].url.hash = value\n  }\n\n  get search() {\n    return this[Internal].url.search\n  }\n\n  set search(value: string) {\n    this[Internal].url.search = value\n  }\n\n  get password() {\n    return this[Internal].url.password\n  }\n\n  set password(value: string) {\n    this[Internal].url.password = value\n  }\n\n  get username() {\n    return this[Internal].url.username\n  }\n\n  set username(value: string) {\n    this[Internal].url.username = value\n  }\n\n  get basePath() {\n    return this[Internal].basePath\n  }\n\n  set basePath(value: string) {\n    this[Internal].basePath = value.startsWith('/') ? value : `/${value}`\n  }\n\n  toString() {\n    return this.href\n  }\n\n  toJSON() {\n    return this.href\n  }\n\n  [Symbol.for('edge-runtime.inspect.custom')]() {\n    return {\n      href: this.href,\n      origin: this.origin,\n      protocol: this.protocol,\n      username: this.username,\n      password: this.password,\n      host: this.host,\n      hostname: this.hostname,\n      port: this.port,\n      pathname: this.pathname,\n      search: this.search,\n      searchParams: this.searchParams,\n      hash: this.hash,\n    }\n  }\n\n  clone() {\n    return new NextURL(String(this), this[Internal].options)\n  }\n}\n","export class PageSignatureError extends Error {\n  constructor({ page }: { page: string }) {\n    super(`The middleware \"${page}\" accepts an async API directly with the form:\n  \n  export function middleware(request, event) {\n    return NextResponse.redirect('/new-location')\n  }\n  \n  Read more: https://nextjs.org/docs/messages/middleware-new-signature\n  `)\n  }\n}\n\nexport class RemovedPageError extends Error {\n  constructor() {\n    super(`The request.page has been deprecated in favour of \\`URLPattern\\`.\n  Read more: https://nextjs.org/docs/messages/middleware-request-page\n  `)\n  }\n}\n\nexport class RemovedUAError extends Error {\n  constructor() {\n    super(`The request.ua has been removed in favour of \\`userAgent\\` function.\n  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent\n  `)\n  }\n}\n","export {\n  RequestCookies,\n  ResponseCookies,\n  stringifyCookie,\n} from 'next/dist/compiled/@edge-runtime/cookies'\n","import type { I18NConfig } from '../../config-shared'\nimport { NextURL } from '../next-url'\nimport { toNodeOutgoingHttpHeaders, validateURL } from '../utils'\nimport { RemovedUAError, RemovedPageError } from '../error'\nimport { RequestCookies } from './cookies'\n\nexport const INTERNALS = Symbol('internal request')\n\n/**\n * This class extends the [Web `Request` API](https://developer.mozilla.org/docs/Web/API/Request) with additional convenience methods.\n *\n * Read more: [Next.js Docs: `NextRequest`](https://nextjs.org/docs/app/api-reference/functions/next-request)\n */\nexport class NextRequest extends Request {\n  /** @internal */\n  [INTERNALS]: {\n    cookies: RequestCookies\n    url: string\n    nextUrl: NextURL\n  }\n\n  constructor(input: URL | RequestInfo, init: RequestInit = {}) {\n    const url =\n      typeof input !== 'string' && 'url' in input ? input.url : String(input)\n\n    validateURL(url)\n\n    // node Request instance requires duplex option when a body\n    // is present or it errors, we don't handle this for\n    // Request being passed in since it would have already\n    // errored if this wasn't configured\n    if (process.env.NEXT_RUNTIME !== 'edge') {\n      if (init.body && init.duplex !== 'half') {\n        init.duplex = 'half'\n      }\n    }\n\n    if (input instanceof Request) super(input, init)\n    else super(url, init)\n\n    const nextUrl = new NextURL(url, {\n      headers: toNodeOutgoingHttpHeaders(this.headers),\n      nextConfig: init.nextConfig,\n    })\n    this[INTERNALS] = {\n      cookies: new RequestCookies(this.headers),\n      nextUrl,\n      url: process.env.__NEXT_NO_MIDDLEWARE_URL_NORMALIZE\n        ? url\n        : nextUrl.toString(),\n    }\n  }\n\n  [Symbol.for('edge-runtime.inspect.custom')]() {\n    return {\n      cookies: this.cookies,\n      nextUrl: this.nextUrl,\n      url: this.url,\n      // rest of props come from Request\n      bodyUsed: this.bodyUsed,\n      cache: this.cache,\n      credentials: this.credentials,\n      destination: this.destination,\n      headers: Object.fromEntries(this.headers),\n      integrity: this.integrity,\n      keepalive: this.keepalive,\n      method: this.method,\n      mode: this.mode,\n      redirect: this.redirect,\n      referrer: this.referrer,\n      referrerPolicy: this.referrerPolicy,\n      signal: this.signal,\n    }\n  }\n\n  public get cookies() {\n    return this[INTERNALS].cookies\n  }\n\n  public get nextUrl() {\n    return this[INTERNALS].nextUrl\n  }\n\n  /**\n   * @deprecated\n   * `page` has been deprecated in favour of `URLPattern`.\n   * Read more: https://nextjs.org/docs/messages/middleware-request-page\n   */\n  public get page() {\n    throw new RemovedPageError()\n  }\n\n  /**\n   * @deprecated\n   * `ua` has been removed in favour of \\`userAgent\\` function.\n   * Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent\n   */\n  public get ua() {\n    throw new RemovedUAError()\n  }\n\n  public get url() {\n    return this[INTERNALS].url\n  }\n}\n\nexport interface RequestInit extends globalThis.RequestInit {\n  nextConfig?: {\n    basePath?: string\n    i18n?: I18NConfig | null\n    trailingSlash?: boolean\n  }\n  signal?: AbortSignal\n  // see https://github.com/whatwg/fetch/pull/1457\n  duplex?: 'half'\n}\n","import type { BaseNextRequest, BaseNextResponse } from './'\nimport type { NodeNextRequest, NodeNextResponse } from './node'\nimport type { WebNextRequest, WebNextResponse } from './web'\n\n/**\n * This file provides some helpers that should be used in conjunction with\n * explicit environment checks. When combined with the environment checks, it\n * will ensure that the correct typings are used as well as enable code\n * elimination.\n */\n\n/**\n * Type guard to determine if a request is a WebNextRequest. This does not\n * actually check the type of the request, but rather the runtime environment.\n * It's expected that when the runtime environment is the edge runtime, that any\n * base request is a WebNextRequest.\n */\nexport const isWebNextRequest = (req: BaseNextRequest): req is WebNextRequest =>\n  process.env.NEXT_RUNTIME === 'edge'\n\n/**\n * Type guard to determine if a response is a WebNextResponse. This does not\n * actually check the type of the response, but rather the runtime environment.\n * It's expected that when the runtime environment is the edge runtime, that any\n * base response is a WebNextResponse.\n */\nexport const isWebNextResponse = (\n  res: BaseNextResponse\n): res is WebNextResponse => process.env.NEXT_RUNTIME === 'edge'\n\n/**\n * Type guard to determine if a request is a NodeNextRequest. This does not\n * actually check the type of the request, but rather the runtime environment.\n * It's expected that when the runtime environment is the node runtime, that any\n * base request is a NodeNextRequest.\n */\nexport const isNodeNextRequest = (\n  req: BaseNextRequest\n): req is NodeNextRequest => process.env.NEXT_RUNTIME !== 'edge'\n\n/**\n * Type guard to determine if a response is a NodeNextResponse. This does not\n * actually check the type of the response, but rather the runtime environment.\n * It's expected that when the runtime environment is the node runtime, that any\n * base response is a NodeNextResponse.\n */\nexport const isNodeNextResponse = (\n  res: BaseNextResponse\n): res is NodeNextResponse => process.env.NEXT_RUNTIME !== 'edge'\n","import type { BaseNextRequest } from '../../../base-http'\nimport type { NodeNextRequest } from '../../../base-http/node'\nimport type { WebNextRequest } from '../../../base-http/web'\nimport type { Writable } from 'node:stream'\n\nimport { getRequestMeta } from '../../../request-meta'\nimport { fromNodeOutgoingHttpHeaders } from '../../utils'\nimport { NextRequest } from '../request'\nimport { isNodeNextRequest, isWebNextRequest } from '../../../base-http/helpers'\n\nexport const ResponseAbortedName = 'ResponseAborted'\nexport class ResponseAborted extends Error {\n  public readonly name = ResponseAbortedName\n}\n\n/**\n * Creates an AbortController tied to the closing of a ServerResponse (or other\n * appropriate Writable).\n *\n * If the `close` event is fired before the `finish` event, then we'll send the\n * `abort` signal.\n */\nexport function createAbortController(response: Writable): AbortController {\n  const controller = new AbortController()\n\n  // If `finish` fires first, then `res.end()` has been called and the close is\n  // just us finishing the stream on our side. If `close` fires first, then we\n  // know the client disconnected before we finished.\n  response.once('close', () => {\n    if (response.writableFinished) return\n\n    controller.abort(new ResponseAborted())\n  })\n\n  return controller\n}\n\n/**\n * Creates an AbortSignal tied to the closing of a ServerResponse (or other\n * appropriate Writable).\n *\n * This cannot be done with the request (IncomingMessage or Readable) because\n * the `abort` event will not fire if to data has been fully read (because that\n * will \"close\" the readable stream and nothing fires after that).\n */\nexport function signalFromNodeResponse(response: Writable): AbortSignal {\n  const { errored, destroyed } = response\n  if (errored || destroyed) {\n    return AbortSignal.abort(errored ?? new ResponseAborted())\n  }\n\n  const { signal } = createAbortController(response)\n  return signal\n}\n\nexport class NextRequestAdapter {\n  public static fromBaseNextRequest(\n    request: BaseNextRequest,\n    signal: AbortSignal\n  ): NextRequest {\n    if (\n      // The type check here ensures that `req` is correctly typed, and the\n      // environment variable check provides dead code elimination.\n      process.env.NEXT_RUNTIME === 'edge' &&\n      isWebNextRequest(request)\n    ) {\n      return NextRequestAdapter.fromWebNextRequest(request)\n    } else if (\n      // The type check here ensures that `req` is correctly typed, and the\n      // environment variable check provides dead code elimination.\n      process.env.NEXT_RUNTIME !== 'edge' &&\n      isNodeNextRequest(request)\n    ) {\n      return NextRequestAdapter.fromNodeNextRequest(request, signal)\n    } else {\n      throw new Error('Invariant: Unsupported NextRequest type')\n    }\n  }\n\n  public static fromNodeNextRequest(\n    request: NodeNextRequest,\n    signal: AbortSignal\n  ): NextRequest {\n    // HEAD and GET requests can not have a body.\n    let body: BodyInit | null = null\n    if (request.method !== 'GET' && request.method !== 'HEAD' && request.body) {\n      // @ts-expect-error - this is handled by undici, when streams/web land use it instead\n      body = request.body\n    }\n\n    let url: URL\n    if (request.url.startsWith('http')) {\n      url = new URL(request.url)\n    } else {\n      // Grab the full URL from the request metadata.\n      const base = getRequestMeta(request, 'initURL')\n      if (!base || !base.startsWith('http')) {\n        // Because the URL construction relies on the fact that the URL provided\n        // is absolute, we need to provide a base URL. We can't use the request\n        // URL because it's relative, so we use a dummy URL instead.\n        url = new URL(request.url, 'http://n')\n      } else {\n        url = new URL(request.url, base)\n      }\n    }\n\n    return new NextRequest(url, {\n      method: request.method,\n      headers: fromNodeOutgoingHttpHeaders(request.headers),\n      duplex: 'half',\n      signal,\n      // geo\n      // ip\n      // nextConfig\n\n      // body can not be passed if request was aborted\n      // or we get a Request body was disturbed error\n      ...(signal.aborted\n        ? {}\n        : {\n            body,\n          }),\n    })\n  }\n\n  public static fromWebNextRequest(request: WebNextRequest): NextRequest {\n    // HEAD and GET requests can not have a body.\n    let body: ReadableStream | null = null\n    if (request.method !== 'GET' && request.method !== 'HEAD') {\n      body = request.body\n    }\n\n    return new NextRequest(request.url, {\n      method: request.method,\n      headers: fromNodeOutgoingHttpHeaders(request.headers),\n      duplex: 'half',\n      signal: request.request.signal,\n      // geo\n      // ip\n      // nextConfig\n\n      // body can not be passed if request was aborted\n      // or we get a Request body was disturbed error\n      ...(request.request.signal.aborted\n        ? {}\n        : {\n            body,\n          }),\n    })\n  }\n}\n","import type { AppPageModule } from './route-modules/app-page/module'\n\n// Combined load times for loading client components\nlet clientComponentLoadStart = 0\nlet clientComponentLoadTimes = 0\nlet clientComponentLoadCount = 0\n\nexport function wrapClientComponentLoader(\n  ComponentMod: AppPageModule\n): AppPageModule['__next_app__'] {\n  if (!('performance' in globalThis)) {\n    return ComponentMod.__next_app__\n  }\n\n  return {\n    require: (...args) => {\n      const startTime = performance.now()\n\n      if (clientComponentLoadStart === 0) {\n        clientComponentLoadStart = startTime\n      }\n\n      try {\n        clientComponentLoadCount += 1\n        return ComponentMod.__next_app__.require(...args)\n      } finally {\n        clientComponentLoadTimes += performance.now() - startTime\n      }\n    },\n    loadChunk: (...args) => {\n      const startTime = performance.now()\n      const result = ComponentMod.__next_app__.loadChunk(...args)\n      // Avoid wrapping `loadChunk`'s result in an extra promise in case something like React depends on its identity.\n      // We only need to know when it's settled.\n      result.finally(() => {\n        clientComponentLoadTimes += performance.now() - startTime\n      })\n      return result\n    },\n  }\n}\n\nexport function getClientComponentLoaderMetrics(\n  options: { reset?: boolean } = {}\n) {\n  const metrics =\n    clientComponentLoadStart === 0\n      ? undefined\n      : {\n          clientComponentLoadStart,\n          clientComponentLoadTimes,\n          clientComponentLoadCount,\n        }\n\n  if (options.reset) {\n    clientComponentLoadStart = 0\n    clientComponentLoadTimes = 0\n    clientComponentLoadCount = 0\n  }\n\n  return metrics\n}\n","import type { ServerResponse } from 'node:http'\n\nimport {\n  ResponseAbortedName,\n  createAbortController,\n} from './web/spec-extension/adapters/next-request'\nimport { DetachedPromise } from '../lib/detached-promise'\nimport { getTracer } from './lib/trace/tracer'\nimport { NextNodeServerSpan } from './lib/trace/constants'\nimport { getClientComponentLoaderMetrics } from './client-component-renderer-logger'\n\nexport function isAbortError(e: any): e is Error & { name: 'AbortError' } {\n  return e?.name === 'AbortError' || e?.name === ResponseAbortedName\n}\n\nfunction createWriterFromResponse(\n  res: ServerResponse,\n  waitUntilForEnd?: Promise<unknown>\n): WritableStream<Uint8Array> {\n  let started = false\n\n  // Create a promise that will resolve once the response has drained. See\n  // https://nodejs.org/api/stream.html#stream_event_drain\n  let drained = new DetachedPromise<void>()\n  function onDrain() {\n    drained.resolve()\n  }\n  res.on('drain', onDrain)\n\n  // If the finish event fires, it means we shouldn't block and wait for the\n  // drain event.\n  res.once('close', () => {\n    res.off('drain', onDrain)\n    drained.resolve()\n  })\n\n  // Create a promise that will resolve once the response has finished. See\n  // https://nodejs.org/api/http.html#event-finish_1\n  const finished = new DetachedPromise<void>()\n  res.once('finish', () => {\n    finished.resolve()\n  })\n\n  // Create a writable stream that will write to the response.\n  return new WritableStream<Uint8Array>({\n    write: async (chunk) => {\n      // You'd think we'd want to use `start` instead of placing this in `write`\n      // but this ensures that we don't actually flush the headers until we've\n      // started writing chunks.\n      if (!started) {\n        started = true\n\n        if (\n          'performance' in globalThis &&\n          process.env.NEXT_OTEL_PERFORMANCE_PREFIX\n        ) {\n          const metrics = getClientComponentLoaderMetrics()\n          if (metrics) {\n            performance.measure(\n              `${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-client-component-loading`,\n              {\n                start: metrics.clientComponentLoadStart,\n                end:\n                  metrics.clientComponentLoadStart +\n                  metrics.clientComponentLoadTimes,\n              }\n            )\n          }\n        }\n\n        res.flushHeaders()\n        getTracer().trace(\n          NextNodeServerSpan.startResponse,\n          {\n            spanName: 'start response',\n          },\n          () => undefined\n        )\n      }\n\n      try {\n        const ok = res.write(chunk)\n\n        // Added by the `compression` middleware, this is a function that will\n        // flush the partially-compressed response to the client.\n        if ('flush' in res && typeof res.flush === 'function') {\n          res.flush()\n        }\n\n        // If the write returns false, it means there's some backpressure, so\n        // wait until it's streamed before continuing.\n        if (!ok) {\n          await drained.promise\n\n          // Reset the drained promise so that we can wait for the next drain event.\n          drained = new DetachedPromise<void>()\n        }\n      } catch (err) {\n        res.end()\n        throw new Error('failed to write chunk to response', { cause: err })\n      }\n    },\n    abort: (err) => {\n      if (res.writableFinished) return\n\n      res.destroy(err)\n    },\n    close: async () => {\n      // if a waitUntil promise was passed, wait for it to resolve before\n      // ending the response.\n      if (waitUntilForEnd) {\n        await waitUntilForEnd\n      }\n\n      if (res.writableFinished) return\n\n      res.end()\n      return finished.promise\n    },\n  })\n}\n\nexport async function pipeToNodeResponse(\n  readable: ReadableStream<Uint8Array>,\n  res: ServerResponse,\n  waitUntilForEnd?: Promise<unknown>\n) {\n  try {\n    // If the response has already errored, then just return now.\n    const { errored, destroyed } = res\n    if (errored || destroyed) return\n\n    // Create a new AbortController so that we can abort the readable if the\n    // client disconnects.\n    const controller = createAbortController(res)\n\n    const writer = createWriterFromResponse(res, waitUntilForEnd)\n\n    await readable.pipeTo(writer, { signal: controller.signal })\n  } catch (err: any) {\n    // If this isn't related to an abort error, re-throw it.\n    if (isAbortError(err)) return\n\n    throw new Error('failed to pipe response', { cause: err })\n  }\n}\n","export function createPromiseWithResolvers<T>(): PromiseWithResolvers<T> {\n  // Shim of Stage 4 Promise.withResolvers proposal\n  let resolve: (value: T | PromiseLike<T>) => void\n  let reject: (reason: any) => void\n  const promise = new Promise<T>((res, rej) => {\n    resolve = res\n    reject = rej\n  })\n  return { resolve: resolve!, reject: reject!, promise }\n}\n","import { InvariantError } from '../../shared/lib/invariant-error'\nimport { createPromiseWithResolvers } from '../../shared/lib/promise-with-resolvers'\n\nexport enum RenderStage {\n  Before = 1,\n  Static = 2,\n  Runtime = 3,\n  Dynamic = 4,\n  Abandoned = 5,\n}\n\nexport type NonStaticRenderStage = RenderStage.Runtime | RenderStage.Dynamic\n\nexport class StagedRenderingController {\n  currentStage: RenderStage = RenderStage.Before\n\n  staticInterruptReason: Error | null = null\n  runtimeInterruptReason: Error | null = null\n  staticStageEndTime: number = Infinity\n  runtimeStageEndTime: number = Infinity\n\n  private runtimeStageListeners: Array<() => void> = []\n  private dynamicStageListeners: Array<() => void> = []\n\n  private runtimeStagePromise = createPromiseWithResolvers<void>()\n  private dynamicStagePromise = createPromiseWithResolvers<void>()\n\n  private mayAbandon: boolean = false\n\n  constructor(\n    private abortSignal: AbortSignal | null = null,\n    private hasRuntimePrefetch: boolean\n  ) {\n    if (abortSignal) {\n      abortSignal.addEventListener(\n        'abort',\n        () => {\n          const { reason } = abortSignal\n          if (this.currentStage < RenderStage.Runtime) {\n            this.runtimeStagePromise.promise.catch(ignoreReject) // avoid unhandled rejections\n            this.runtimeStagePromise.reject(reason)\n          }\n          if (\n            this.currentStage < RenderStage.Dynamic ||\n            this.currentStage === RenderStage.Abandoned\n          ) {\n            this.dynamicStagePromise.promise.catch(ignoreReject) // avoid unhandled rejections\n            this.dynamicStagePromise.reject(reason)\n          }\n        },\n        { once: true }\n      )\n\n      this.mayAbandon = true\n    }\n  }\n\n  onStage(stage: NonStaticRenderStage, callback: () => void) {\n    if (this.currentStage >= stage) {\n      callback()\n    } else if (stage === RenderStage.Runtime) {\n      this.runtimeStageListeners.push(callback)\n    } else if (stage === RenderStage.Dynamic) {\n      this.dynamicStageListeners.push(callback)\n    } else {\n      // This should never happen\n      throw new InvariantError(`Invalid render stage: ${stage}`)\n    }\n  }\n\n  canSyncInterrupt() {\n    // If we haven't started the render yet, it can't be interrupted.\n    if (this.currentStage === RenderStage.Before) {\n      return false\n    }\n\n    const boundaryStage = this.hasRuntimePrefetch\n      ? RenderStage.Dynamic\n      : RenderStage.Runtime\n    return this.currentStage < boundaryStage\n  }\n\n  syncInterruptCurrentStageWithReason(reason: Error) {\n    if (this.currentStage === RenderStage.Before) {\n      return\n    }\n\n    // If Sync IO occurs during the initial (abandonable) render, we'll retry it,\n    // so we want a slightly different flow.\n    // See the implementation of `abandonRenderImpl` for more explanation.\n    if (this.mayAbandon) {\n      return this.abandonRenderImpl()\n    }\n\n    // If we're in the final render, we cannot abandon it. We need to advance to the Dynamic stage\n    // and capture the interruption reason.\n    switch (this.currentStage) {\n      case RenderStage.Static: {\n        this.staticInterruptReason = reason\n        this.advanceStage(RenderStage.Dynamic)\n        return\n      }\n      case RenderStage.Runtime: {\n        // We only error for Sync IO in the runtime stage if the route\n        // is configured to use runtime prefetching.\n        // We do this to reflect the fact that during a runtime prefetch,\n        // Sync IO aborts aborts the render.\n        // Note that `canSyncInterrupt` should prevent us from getting here at all\n        // if runtime prefetching isn't enabled.\n        if (this.hasRuntimePrefetch) {\n          this.runtimeInterruptReason = reason\n          this.advanceStage(RenderStage.Dynamic)\n        }\n        return\n      }\n      case RenderStage.Dynamic:\n      case RenderStage.Abandoned:\n      default:\n    }\n  }\n\n  getStaticInterruptReason() {\n    return this.staticInterruptReason\n  }\n\n  getRuntimeInterruptReason() {\n    return this.runtimeInterruptReason\n  }\n\n  getStaticStageEndTime() {\n    return this.staticStageEndTime\n  }\n\n  getRuntimeStageEndTime() {\n    return this.runtimeStageEndTime\n  }\n\n  abandonRender() {\n    if (!this.mayAbandon) {\n      throw new InvariantError(\n        '`abandonRender` called on a stage controller that cannot be abandoned.'\n      )\n    }\n\n    this.abandonRenderImpl()\n  }\n\n  private abandonRenderImpl() {\n    // In staged rendering, only the initial render is abandonable.\n    // We can abandon the initial render if\n    //   1. We notice a cache miss, and need to wait for caches to fill\n    //   2. A sync IO error occurs, and the render should be interrupted\n    //      (this might be a lazy intitialization of a module,\n    //       so we still want to restart in this case and see if it still occurs)\n    // In either case, we'll be doing another render after this one,\n    // so we only want to unblock the Runtime stage, not Dynamic, because\n    // unblocking the dynamic stage would likely lead to wasted (uncached) IO.\n    const { currentStage } = this\n    switch (currentStage) {\n      case RenderStage.Static: {\n        this.currentStage = RenderStage.Abandoned\n        this.resolveRuntimeStage()\n        return\n      }\n      case RenderStage.Runtime: {\n        this.currentStage = RenderStage.Abandoned\n        return\n      }\n      case RenderStage.Dynamic:\n      case RenderStage.Before:\n      case RenderStage.Abandoned:\n        break\n      default: {\n        currentStage satisfies never\n      }\n    }\n  }\n\n  advanceStage(\n    stage: RenderStage.Static | RenderStage.Runtime | RenderStage.Dynamic\n  ) {\n    // If we're already at the target stage or beyond, do nothing.\n    // (this can happen e.g. if sync IO advanced us to the dynamic stage)\n    if (stage <= this.currentStage) {\n      return\n    }\n\n    let currentStage = this.currentStage\n    this.currentStage = stage\n\n    if (currentStage < RenderStage.Runtime && stage >= RenderStage.Runtime) {\n      this.staticStageEndTime = performance.now() + performance.timeOrigin\n      this.resolveRuntimeStage()\n    }\n    if (currentStage < RenderStage.Dynamic && stage >= RenderStage.Dynamic) {\n      this.runtimeStageEndTime = performance.now() + performance.timeOrigin\n      this.resolveDynamicStage()\n      return\n    }\n  }\n\n  /** Fire the `onStage` listeners for the runtime stage and unblock any promises waiting for it. */\n  private resolveRuntimeStage() {\n    const runtimeListeners = this.runtimeStageListeners\n    for (let i = 0; i < runtimeListeners.length; i++) {\n      runtimeListeners[i]()\n    }\n    runtimeListeners.length = 0\n    this.runtimeStagePromise.resolve()\n  }\n\n  /** Fire the `onStage` listeners for the dynamic stage and unblock any promises waiting for it. */\n  private resolveDynamicStage() {\n    const dynamicListeners = this.dynamicStageListeners\n    for (let i = 0; i < dynamicListeners.length; i++) {\n      dynamicListeners[i]()\n    }\n    dynamicListeners.length = 0\n    this.dynamicStagePromise.resolve()\n  }\n\n  private getStagePromise(stage: NonStaticRenderStage): Promise<void> {\n    switch (stage) {\n      case RenderStage.Runtime: {\n        return this.runtimeStagePromise.promise\n      }\n      case RenderStage.Dynamic: {\n        return this.dynamicStagePromise.promise\n      }\n      default: {\n        stage satisfies never\n        throw new InvariantError(`Invalid render stage: ${stage}`)\n      }\n    }\n  }\n\n  waitForStage(stage: NonStaticRenderStage) {\n    return this.getStagePromise(stage)\n  }\n\n  delayUntilStage<T>(\n    stage: NonStaticRenderStage,\n    displayName: string | undefined,\n    resolvedValue: T\n  ) {\n    const ioTriggerPromise = this.getStagePromise(stage)\n\n    const promise = makeDevtoolsIOPromiseFromIOTrigger(\n      ioTriggerPromise,\n      displayName,\n      resolvedValue\n    )\n\n    // Analogously to `makeHangingPromise`, we might reject this promise if the signal is invoked.\n    // (e.g. in the case where we don't want want the render to proceed to the dynamic stage and abort it).\n    // We shouldn't consider this an unhandled rejection, so we attach a noop catch handler here to suppress this warning.\n    if (this.abortSignal) {\n      promise.catch(ignoreReject)\n    }\n    return promise\n  }\n}\n\nfunction ignoreReject() {}\n\n// TODO(restart-on-cache-miss): the layering of `delayUntilStage`,\n// `makeDevtoolsIOPromiseFromIOTrigger` and and `makeDevtoolsIOAwarePromise`\n// is confusing, we should clean it up.\nfunction makeDevtoolsIOPromiseFromIOTrigger<T>(\n  ioTrigger: Promise<any>,\n  displayName: string | undefined,\n  resolvedValue: T\n): Promise<T> {\n  // If we create a `new Promise` and give it a displayName\n  // (with no userspace code above us in the stack)\n  // React Devtools will use it as the IO cause when determining \"suspended by\".\n  // In particular, it should shadow any inner IO that resolved/rejected the promise\n  // (in case of staged rendering, this will be the `setTimeout` that triggers the relevant stage)\n  const promise = new Promise<T>((resolve, reject) => {\n    ioTrigger.then(resolve.bind(null, resolvedValue), reject)\n  })\n  if (displayName !== undefined) {\n    // @ts-expect-error\n    promise.displayName = displayName\n  }\n  return promise\n}\n","export type ActionRevalidationKind = 0 | 1 | 2\n\nexport const ActionDidNotRevalidate = 0\nexport const ActionDidRevalidateStaticAndDynamic = 1\nexport const ActionDidRevalidateDynamicOnly = 2\n"],"names":["registerServerReference","isHangingPromiseRejectionError","makeDevtoolsIOAwarePromise","makeHangingPromise","err","digest","HANGING_PROMISE_REJECTION","HangingPromiseRejectionError","Error","constructor","route","expression","abortListenersBySignal","WeakMap","signal","aborted","Promise","reject","hangingPromise","_","boundRejection","bind","currentListeners","get","push","listeners","set","addEventListener","i","length","once","catch","ignoreReject","underlying","requestStore","stage","stagedRendering","delayUntilStage","undefined","resolve","setTimeout","parsePath","path","hashIndex","indexOf","queryIndex","hasQuery","pathname","substring","query","hash","slice","pathHasPrefix","prefix","startsWith","removePathPrefix","withoutPrefix","AppRenderSpan","AppRouteRouteHandlersSpan","BaseServerSpan","LoadComponentsSpan","LogSpanAllowList","MiddlewareSpan","NextNodeServerSpan","NextServerSpan","NextVanillaSpanAllowlist","NodeSpan","RenderSpan","ResolveMetadataSpan","RouterSpan","StartServerSpan","Set","isThenable","promise","then","BubbledError","SpanKind","SpanStatusCode","getTracer","isBubbledError","NEXT_OTEL_PERFORMANCE_PREFIX","process","env","api","NEXT_RUNTIME","require","context","propagation","trace","ROOT_CONTEXT","bubble","result","error","closeSpanWithError","span","setAttribute","recordException","name","setStatus","code","ERROR","message","end","rootSpanAttributesStore","Map","rootSpanIdKey","createContextKey","lastSpanId","getSpanId","clientTraceDataSetter","carrier","key","value","NextTracerImpl","getTracerInstance","getContext","getTracePropagationData","activeContext","active","entries","inject","getActiveScopeSpan","getSpan","withPropagatedContext","fn","getter","getSpanContext","remoteContext","extract","with","args","type","fnOrOptions","fnOrEmpty","options","spanName","has","NEXT_OTEL_VERBOSE","hideSpan","spanContext","parentSpan","existingRootSpanId","getValue","isRootSpan","spanId","attributes","setValue","startActiveSpan","startTime","globalThis","performance","now","cleanedUp","onCleanup","delete","measure","split","pop","replace","match","toLowerCase","start","Object","res","finally","wrap","tracer","optionsObj","apply","arguments","lastArgId","cb","scopeBoundCb","_span","done","startSpan","setSpan","getRootSpanAttributes","setRootSpanAttribute","withSpan","DetachedPromise","rej","atLeastOneTask","scheduleImmediate","scheduleOnNextTick","waitAtLeastOneReactRenderTask","nextTick","setImmediate","r","ENCODED_TAGS","OPENING","HTML","Uint8Array","BODY","CLOSED","HEAD","BODY_AND_HTML","META","ICON_MARK","indexOfUint8Array","isEquivalentUint8Arrays","removeFromUint8Array","a","b","completeMatch","j","tagIndex","subarray","removed","MISSING_ROOT_TAGS_ERROR","insertBuildIdComment","DOCTYPE_PREFIX","MAX_BUILD_ID_LENGTH","escapeBuildId","buildId","truncated","originalHtml","includes","computeCacheBustingSearchParam","prefetchHeader","segmentPrefetchHeader","stateTreeHeader","nextUrlHeader","hexHash","join","chainStreams","continueDynamicHTMLResume","continueDynamicPrerender","continueFizzStream","continueStaticFallbackPrerender","continueStaticPrerender","createBufferedTransformStream","createDocumentClosingStream","createRootLayoutValidatorStream","renderToInitialFizzStream","streamFromBuffer","streamFromString","streamToBuffer","streamToString","streamToUint8Array","voidCatch","encoder","TextEncoder","streams","ReadableStream","controller","close","readable","writable","TransformStream","pipeTo","preventClose","nextStream","lastStream","str","enqueue","encode","chunk","streamToChunks","stream","reader","getReader","chunks","read","concatUint8Arrays","totalLength","reduce","sum","offset","Buffer","concat","decoder","TextDecoder","fatal","string","decode","maxBufferByteLength","Infinity","bufferedChunks","bufferByteLength","pending","flush","copiedBytes","bufferedChunk","byteLength","scheduleFlush","detached","transform","createPrefetchCommentStream","isBuildTimePrerendering","didTransformFirstChunk","chunkStr","updatedChunkStr","ReactDOMServer","element","streamOptions","renderToReadableStream","createMetadataTransformStream","insert","chunkIndex","isMarkRemoved","iconMarkIndex","closedHeadIndex","iconMarkLength","replaced","insertion","encodedInsertion","insertionLength","createHeadInsertionTransformStream","inserted","hasBytes","index","insertedHeadContent","createClientResumeScriptInsertionTransformStream","segmentPath","cacheBustingHeader","searchStr","NEXT_RSC_UNION_QUERY","NEXT_CLIENT_RESUME_SCRIPT","RSC_HEADER","NEXT_ROUTER_PREFETCH_HEADER","NEXT_ROUTER_SEGMENT_PREFETCH_HEADER","didAlreadyInsert","headClosingTagIndex","createDeferredSuffixStream","suffix","flushed","createFlightDataInjectionTransformStream","delayDataUntilFirstHtmlChunk","htmlStreamFinished","pull","donePulling","startOrContinuePulling","startPulling","CLOSE_TAG","createMoveSuffixStream","foundSuffix","before","after","createStripDocumentClosingTagsTransform","foundHtml","foundBody","missingTags","map","c","chainTransformers","transformers","transformer","pipeThrough","renderStream","inlinedDataStream","isStaticGeneration","getServerInsertedHTML","getServerInsertedMetadata","validateRootLayout","suffixUnclosed","allReady","prerenderStream","DynamicServerError","isDynamicServerError","DYNAMIC_ERROR_CODE","description","StaticGenBailoutError","isStaticGenBailoutError","NEXT_STATIC_GEN_BAILOUT","METADATA_BOUNDARY_NAME","OUTLET_BOUNDARY_NAME","ROOT_LAYOUT_BOUNDARY_NAME","VIEWPORT_BOUNDARY_NAME","BailoutToCSRError","isBailoutToCSRError","BAILOUT_TO_CSR","reason","Postpone","PreludeState","abortAndThrowOnSynchronousRequestDataAccess","abortOnSynchronousPlatformIOAccess","accessedDynamicData","annotateDynamicAccess","consumeDynamicAccess","createDynamicTrackingState","createDynamicValidationState","createHangingInputAbortSignal","createRenderInBrowserAbortSignal","delayUntilRuntimeStage","formatDynamicAPIAccesses","getFirstDynamicReason","getStaticShellDisallowedDynamicReasons","isDynamicPostpone","isPrerenderInterruptedError","logDisallowedDynamicError","markCurrentScopeAsDynamic","postponeWithTracking","throwIfDisallowedDynamic","throwToInterruptStaticGeneration","trackAllowedDynamicAccess","trackDynamicDataInDynamicRender","trackDynamicHoleInRuntimeShell","trackDynamicHoleInStaticShell","useDynamicRouteParams","useDynamicSearchParams","hasPostpone","React","unstable_postpone","isDebugDynamicAccesses","dynamicAccesses","syncDynamicErrorWithStack","hasSuspenseAboveBody","hasDynamicMetadata","dynamicMetadata","hasDynamicViewport","hasAllowedDynamic","dynamicErrors","trackingState","store","workUnitStore","forceDynamic","forceStatic","dynamicShouldError","dynamicTracking","revalidate","dynamicUsageDescription","dynamicUsageStack","stack","NODE_ENV","usedDynamic","prerenderStore","abortOnSynchronousDynamicDataAccess","createPrerenderInterruptedError","abort","errorWithStack","prerenderSignal","workUnitAsyncStorage","getStore","assertPostpone","createPostponeReason","isDynamicPostponeReason","NEXT_PRERENDER_INTERRUPTED","serverDynamic","clientDynamic","filter","access","line","AbortController","cacheSignal","inputReady","runtimeStagePromise","getRuntimeStagePromise","workStore","workAsyncStorage","fallbackParams","fallbackRouteParams","size","use","renderSignal","InvariantError","throwForMissingRequestStore","hasSuspenseRegex","bodyAndImplicitTags","hasSuspenseBeforeRootLayoutWithoutBodyOrImplicitBodyRegex","RegExp","hasMetadataRegex","hasViewportRegex","hasOutletRegex","componentStack","dynamicValidation","test","createErrorWithComponentOrOwnerStack","ownerStack","captureOwnerStack","console","dev","hasReadableErrorStacks","prelude","NEXT_REQUEST_META","addRequestMeta","getRequestMeta","removeRequestMeta","setRequestMeta","Symbol","for","req","meta","request","detectDomainLocale","domainItems","hostname","detectedLocale","item","domainHostname","domain","defaultLocale","locales","some","locale","addPathPrefix","addPathSuffix","addLocale","ignorePrefix","lower","formatNextPathnameInfo","info","trailingSlash","removeTrailingSlash","basePath","endsWith","getHostname","parsed","headers","host","Array","isArray","toString","getNextPathnameInfo","i18n","nextConfig","pathnameNoDataPrefix","paths","parseData","i18nProvider","analyze","normalizeLocalePath","NextURL","REGEX_LOCALHOST_HOSTNAME","parseURL","url","base","URL","String","Internal","input","baseOrOpts","opts","__NEXT_NO_MIDDLEWARE_URL_NORMALIZE","domainLocale","domains","formatPathname","forceLocale","formatSearch","search","TypeError","searchParams","port","protocol","href","origin","password","username","toJSON","clone","PageSignatureError","RemovedPageError","RemovedUAError","page","RequestCookies","ResponseCookies","stringifyCookie","INTERNALS","NextRequest","Request","init","validateURL","body","duplex","nextUrl","toNodeOutgoingHttpHeaders","cookies","bodyUsed","cache","credentials","destination","fromEntries","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","ua","isNodeNextRequest","isNodeNextResponse","isWebNextRequest","isWebNextResponse","NextRequestAdapter","ResponseAborted","ResponseAbortedName","createAbortController","signalFromNodeResponse","response","writableFinished","errored","destroyed","AbortSignal","fromBaseNextRequest","fromWebNextRequest","fromNodeNextRequest","fromNodeOutgoingHttpHeaders","getClientComponentLoaderMetrics","wrapClientComponentLoader","clientComponentLoadStart","clientComponentLoadTimes","clientComponentLoadCount","ComponentMod","__next_app__","loadChunk","metrics","reset","isAbortError","pipeToNodeResponse","e","createWriterFromResponse","waitUntilForEnd","started","drained","onDrain","on","off","finished","WritableStream","write","flushHeaders","startResponse","ok","cause","destroy","writer","createPromiseWithResolvers","RenderStage","StagedRenderingController","abortSignal","hasRuntimePrefetch","currentStage","staticInterruptReason","runtimeInterruptReason","staticStageEndTime","runtimeStageEndTime","runtimeStageListeners","dynamicStageListeners","dynamicStagePromise","mayAbandon","onStage","callback","canSyncInterrupt","boundaryStage","syncInterruptCurrentStageWithReason","abandonRenderImpl","advanceStage","getStaticInterruptReason","getRuntimeInterruptReason","getStaticStageEndTime","getRuntimeStageEndTime","abandonRender","resolveRuntimeStage","timeOrigin","resolveDynamicStage","runtimeListeners","dynamicListeners","getStagePromise","waitForStage","displayName","resolvedValue","ioTriggerPromise","makeDevtoolsIOPromiseFromIOTrigger","ioTrigger","ActionDidNotRevalidate","ActionDidRevalidateDynamicOnly","ActionDidRevalidateStaticAndDynamic"],"mappings":"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","ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]}